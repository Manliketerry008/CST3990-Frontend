<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Silk Touch - Modern Fashion E-commerce</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>👕</text></svg>">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.4.21/vue.global.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.0/axios.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="app">
        <!-- Header -->
        <header class="header">
            <div class="container">
                <nav class="nav">
                    <a href="#" class="logo" @click="currentView = 'home'">
                        <i class="fas fa-tshirt"></i>
                        Silk Touch
                        <span v-if="!apiConnected" style="font-size: 0.6rem; background: #ff4757; padding: 2px 6px; border-radius: 10px; margin-left: 10px;">DEMO</span>
                    </a>
                    
                    <div class="search-container">
                        <input 
                            v-model="searchQuery" 
                            @input="handleSearch"
                            @keyup.enter="performSearch"
                            type="text" 
                            placeholder="Search for clothing..."
                            class="search-input"
                        />
                        <button @click="performSearch" class="search-btn">
                            <i class="fas fa-search"></i>
                        </button>
                        
                        <div v-if="suggestions.length > 0" class="search-suggestions">
                            <div 
                                v-for="suggestion in suggestions" 
                                :key="suggestion"
                                @click="selectSuggestion(suggestion)"
                                class="suggestion-item"
                            >
                                {{ suggestion }}
                            </div>
                        </div>
                    </div>
                    
                    <div class="nav-actions">
                        <button v-if="!apiConnected" @click="retryConnection" class="btn btn-secondary" style="margin-right: 1rem;">
                            <i class="fas fa-sync"></i>
                            Retry API
                        </button>
                        
                        <button v-if="!user" @click="showLogin = true" class="btn btn-secondary">
                            <i class="fas fa-sign-in-alt"></i>
                            Login
                        </button>
                        
                        <div v-if="user" class="user-menu">
                            <span>Welcome, {{ user.name }}!</span>
                            <button @click="logout" class="btn btn-secondary">
                                <i class="fas fa-sign-out-alt"></i>
                                Logout
                            </button>
                        </div>
                        
                        <button @click="showCart = true" class="btn btn-primary" style="position: relative;">
                            <i class="fas fa-shopping-cart"></i>
                            Cart
                            <span v-if="cartItemsCount > 0" class="cart-badge">{{ cartItemsCount }}</span>
                        </button>
                    </div>
                </nav>
            </div>
        </header>

        <!-- Category Navigation -->
        <nav class="category-nav">
            <div class="container">
                <div class="category-links">
                    <a href="#" @click="setCategory('')" :class="{ active: currentCategory === '' }" class="category-link">
                        All Products
                    </a>
                    <a href="#" @click="setCategory('men')" :class="{ active: currentCategory === 'men' }" class="category-link">
                        Men
                    </a>
                    <a href="#" @click="setCategory('women')" :class="{ active: currentCategory === 'women' }" class="category-link">
                        Women
                    </a>
                    <a href="#" @click="setCategory('kids')" :class="{ active: currentCategory === 'kids' }" class="category-link">
                        Kids
                    </a>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <div class="container">
                <!-- Hero Section -->
                <section v-if="currentView === 'home'" class="hero">
                    <h1>Welcome to Silk Touch</h1>
                    <p>Discover the latest fashion trends for the whole family</p>
                    <button @click="setCategory('')" class="btn btn-primary">
                        Shop Now
                    </button>
                </section>

                <!-- Filters -->
                <section v-if="currentView === 'home' || currentView === 'products'" class="filters">
                    <div class="filter-grid">
                        <div class="filter-group">
                            <label>Sort By</label>
                            <select v-model="filters.sort" @change="loadProducts" class="filter-input">
                                <option value="">Default</option>
                                <option value="price_low">Price: Low to High</option>
                                <option value="price_high">Price: High to Low</option>
                                <option value="newest">Newest</option>
                                <option value="rating">Rating</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label>Price Range</label>
                            <div style="display: flex; gap: 0.5rem;">
                                <input 
                                    v-model="filters.minPrice" 
                                    @input="loadProducts"
                                    type="number" 
                                    placeholder="Min"
                                    class="filter-input"
                                />
                                <input 
                                    v-model="filters.maxPrice" 
                                    @input="loadProducts"
                                    type="number" 
                                    placeholder="Max"
                                    class="filter-input"
                                />
                            </div>
                        </div>
                        
                        <div class="filter-group">
                            <label>Size</label>
                            <select v-model="filters.size" @change="loadProducts" class="filter-input">
                                <option value="">All Sizes</option>
                                <option value="XS">XS</option>
                                <option value="S">S</option>
                                <option value="M">M</option>
                                <option value="L">L</option>
                                <option value="XL">XL</option>
                                <option value="XXL">XXL</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label>Brand</label>
                            <input 
                                v-model="filters.brand" 
                                @input="loadProducts"
                                type="text" 
                                placeholder="Brand name"
                                class="filter-input"
                            />
                        </div>
                    </div>
                </section>

                <!-- Products -->
                <section v-if="currentView === 'home' || currentView === 'products'" class="products-container">
                    <div class="products-header">
                        <h2>{{ currentCategory ? currentCategory.charAt(0).toUpperCase() + currentCategory.slice(1) + "'s" : "All" }} Collection</h2>
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <p>{{ totalProducts }} products found</p>
                        </div>
                    </div>
                    
                    <div v-if="loading" class="loading">
                        <div class="spinner"></div>
                        <p style="margin-top: 1rem;">
                            {{ apiConnected ? 'Loading products from server...' : 'Loading demo products...' }}
                        </p>
                    </div>
                    
                    <div v-else class="products-grid">
                        <div v-for="product in products" :key="product._id" class="product-card">
                            <div class="product-image">
                                <img 
                                    :src="product.image" 
                                    :alt="product.name"
                                    @error="handleImageError"
                                    style="width: 100%; height: 100%; object-fit: cover; border-radius: 10px;"
                                />
                                <div class="product-badges">
                                    <span v-if="product.featured" class="badge badge-featured">Featured</span>
                                    <span v-if="product.stock < 10" class="badge badge-low-stock">Low Stock</span>
                                </div>
                            </div>
                            <div class="product-info">
                                <div class="product-brand">{{ product.brand }}</div>
                                <div class="product-name">{{ product.name }}</div>
                                <div class="product-rating">
                                    <div class="stars">
                                        <i v-for="i in 5" :key="i" :class="['fas', i <= product.rating ? 'fa-star' : 'fa-star-o']"></i>
                                    </div>
                                    <span>({{ product.rating }})</span>
                                </div>
                                <div class="product-price">AED {{ product.price }}</div>
                                <div class="product-actions">
                                    <button @click="addToCart(product)" class="btn-add-cart">
                                        <i class="fas fa-plus"></i>
                                        Add to Cart
                                    </button>
                                    <button @click="viewProduct(product)" class="btn-view">
                                        <i class="fas fa-eye"></i>
                                        View
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Pagination -->
                    <div v-if="totalPages > 1" class="pagination">
                        <button 
                            @click="changePage(currentPage - 1)" 
                            :disabled="currentPage === 1"
                            class="page-btn"
                        >
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        
                        <button 
                            v-for="page in Math.min(totalPages, 5)" 
                            :key="page"
                            @click="changePage(page)"
                            :class="{ active: page === currentPage }"
                            class="page-btn"
                        >
                            {{ page }}
                        </button>
                        
                        <button 
                            @click="changePage(currentPage + 1)" 
                            :disabled="currentPage === totalPages"
                            class="page-btn"
                        >
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </section>
            </div>
        </main>

        <!-- Clean Product Details Modal -->
        <transition name="fade">
            <div v-if="showProductDetails" class="modal-overlay" @click="showProductDetails = false">
                <div class="product-modal" @click.stop>
                    <button @click="showProductDetails = false" class="modal-close">
                        <i class="fas fa-times"></i>
                    </button>
                    
                    <div class="modal-content">
                        <!-- Product Image -->
                        <div class="product-image-section">
                            <div class="product-main-image">
                                <img :src="selectedProduct.image" :alt="selectedProduct.name" />
                                <div v-if="selectedProduct.featured" class="featured-badge">Featured</div>
                            </div>
                        </div>
                        
                        <!-- Product Info -->
                        <div class="product-info">
                            <div class="product-header">
                                <span class="product-brand">{{ selectedProduct.brand }}</span>
                                <h2 class="product-title">{{ selectedProduct.name }}</h2>
                                <div class="product-rating">
                                    <div class="stars">
                                        <i v-for="i in 5" :key="i" :class="['fas', i <= selectedProduct.rating ? 'fa-star' : 'fa-star-o']"></i>
                                    </div>
                                    <span class="rating-text">{{ selectedProduct.rating }} ({{ Math.floor(Math.random() * 50) + 10 }} reviews)</span>
                                </div>
                                <div class="product-price">AED {{ selectedProduct.price }}</div>
                            </div>
                            
                            <div class="product-description">
                                <p>{{ selectedProduct.description }}</p>
                            </div>
                            
                            <!-- Options -->
                            <div class="product-options">
                                <!-- Size Selection -->
                                <div v-if="selectedProduct.sizes && selectedProduct.sizes.length > 0" class="option-group">
                                    <label>Size</label>
                                    <div class="option-buttons">
                                        <button 
                                            v-for="size in selectedProduct.sizes" 
                                            :key="size"
                                            @click="selectedSize = size"
                                            :class="['option-btn', { active: selectedSize === size }]"
                                        >
                                            {{ size }}
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Color Selection -->
                                <div v-if="selectedProduct.colors && selectedProduct.colors.length > 0" class="option-group">
                                    <label>Color</label>
                                    <div class="option-buttons">
                                        <button 
                                            v-for="color in selectedProduct.colors" 
                                            :key="color"
                                            @click="selectedColor = color"
                                            :class="['option-btn', { active: selectedColor === color }]"
                                        >
                                            {{ color }}
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Quantity -->
                                <div class="option-group">
                                    <label>Quantity</label>
                                    <div class="quantity-selector">
                                        <button @click="selectedQuantity = Math.max(1, selectedQuantity - 1)" class="qty-btn">-</button>
                                        <span class="qty-display">{{ selectedQuantity }}</span>
                                        <button @click="selectedQuantity = Math.min(10, selectedQuantity + 1)" class="qty-btn">+</button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Action Button -->
                            <button @click="addToCartFromDetails" class="add-to-cart-btn">
                                Add to Cart - AED {{ selectedProduct.price * selectedQuantity }}
                            </button>
                            
                            <!-- Product Details -->
                            <div class="product-details">
                                <div class="detail-item">
                                    <strong>Category:</strong> {{ selectedProduct.category }}
                                </div>
                                <div v-if="selectedProduct.subcategory" class="detail-item">
                                    <strong>Type:</strong> {{ selectedProduct.subcategory }}
                                </div>
                                <div class="detail-item">
                                    <strong>Stock:</strong> {{ selectedProduct.stock }} items available
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </transition>

        <!-- Chatbot -->
        <div class="chatbot-container">
            <button @click="toggleChatbot" class="chatbot-toggle">
                <i class="fas fa-comments"></i>
            </button>
            
            <transition name="fade">
                <div v-if="showChatbot" class="chatbot-window">
                    <div class="chatbot-header">
                        <div>Silk Touch Assistant</div>
                        <button @click="showChatbot = false" style="background: none; border: none; color: white; font-size: 1.2rem;">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <div class="chatbot-messages" ref="chatMessages">
                        <div v-for="message in chatMessages" :key="message.id" :class="['message', message.type]">
                            {{ message.text }}
                        </div>
                    </div>
                    
                    <div class="chatbot-input">
                        <input 
                            v-model="chatInput" 
                            @keyup.enter="sendMessage"
                            placeholder="Ask me anything..."
                            :disabled="chatLoading"
                        />
                        <button @click="sendMessage" :disabled="chatLoading">
                            <i v-if="chatLoading" class="fas fa-spinner fa-spin"></i>
                            <i v-else class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </transition>
        </div>

        <!-- Login Modal -->
        <transition name="fade">
            <div v-if="showLogin" class="modal-overlay" @click="showLogin = false">
                <div class="modal" @click.stop>
                    <div class="modal-header">
                        <h2>{{ loginMode === 'login' ? 'Login' : 'Register' }}</h2>
                        <button @click="showLogin = false" class="modal-close">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <form @submit.prevent="handleAuth">
                        <div v-if="loginMode === 'register'" class="form-group">
                            <label>Name</label>
                            <input v-model="authForm.name" type="text" required />
                        </div>
                        
                        <div class="form-group">
                            <label>Email</label>
                            <input v-model="authForm.email" type="email" required />
                        </div>
                        
                        <div class="form-group">
                            <label>Password</label>
                            <input v-model="authForm.password" type="password" required />
                        </div>
                        
                        <div v-if="authError" class="alert alert-error">
                            {{ authError }}
                        </div>
                        
                        <button type="submit" class="btn btn-primary" style="width: 100%; margin-bottom: 1rem;">
                            {{ loginMode === 'login' ? 'Login' : 'Register' }}
                        </button>
                    </form>
                    
                    <p style="text-align: center;">
                        {{ loginMode === 'login' ? "Don't have an account?" : 'Already have an account?' }}
                        <a href="#" @click="toggleLoginMode" style="color: #667eea;">
                            {{ loginMode === 'login' ? 'Register' : 'Login' }}
                        </a>
                    </p>
                </div>
            </div>
        </transition>

        <!-- Cart Modal -->
        <transition name="fade">
            <div v-if="showCart" class="modal-overlay" @click="showCart = false">
                <div class="modal" @click.stop style="max-width: 600px;">
                    <div class="modal-header">
                        <h2>Shopping Cart</h2>
                        <button @click="showCart = false" class="modal-close">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <div v-if="cart.length === 0" style="text-align: center; padding: 2rem;">
                        <i class="fas fa-shopping-cart" style="font-size: 3rem; color: #ddd; margin-bottom: 1rem;"></i>
                        <p>Your cart is empty</p>
                    </div>
                    
                    <div v-else>
                        <div v-for="item in cart" :key="item.id" class="cart-item">
                            <div class="cart-item-image">
                                <i class="fas fa-tshirt"></i>
                            </div>
                            <div class="cart-item-info">
                                <div class="product-name">{{ item.name }}</div>
                                <div class="product-brand">{{ item.brand }}</div>
                                <div class="product-price">AED {{ item.price }}</div>
                                <div v-if="item.size">Size: {{ item.size }}</div>
                                <div v-if="item.color">Color: {{ item.color }}</div>
                            </div>
                            <div class="cart-item-actions">
                                <button @click="updateQuantity(item, item.quantity - 1)" class="quantity-btn">
                                    <i class="fas fa-minus"></i>
                                </button>
                                <span style="margin: 0 1rem;">{{ item.quantity }}</span>
                                <button @click="updateQuantity(item, item.quantity + 1)" class="quantity-btn">
                                    <i class="fas fa-plus"></i>
                                </button>
                                <button @click="removeFromCart(item)" class="quantity-btn" style="margin-left: 1rem; color: #dc3545;">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="cart-summary">
                            <div style="display: flex; justify-content: space-between; font-size: 1.2rem; font-weight: bold;">
                                <span>Total: AED {{ cartTotal }}</span>
                            </div>
                            <button @click="checkout" class="btn btn-primary" style="width: 100%; margin-top: 1rem;">
                                Proceed to Checkout
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </transition>

        <!-- Success/Error Messages -->
        <transition name="fade">
            <div v-if="message" :class="['alert', message.type === 'success' ? 'alert-success' : 'alert-error']" style="position: fixed; top: 20px; right: 20px; z-index: 3000; max-width: 300px;">
                {{ message.text }}
            </div>
        </transition>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    // API Configuration - Try both URLs
                    baseURL: window.location.hostname === 'localhost' ? 'https://cst3990-backend-8f55.onrender.com/api' : 'http://127.0.0.1:5000/api',
                    apiConnected: false,
                    
                    // User & Auth
                    user: null,
                    token: localStorage.getItem('token'),
                    showLogin: false,
                    loginMode: 'login',
                    authForm: {
                        name: '',
                        email: '',
                        password: ''
                    },
                    authError: '',
                    
                    // Navigation
                    currentView: 'home',
                    currentCategory: '',
                    
                    // Search
                    searchQuery: '',
                    suggestions: [],
                    
                    // Products
                    products: [],
                    loading: false,
                    currentPage: 1,
                    totalPages: 1,
                    totalProducts: 0,
                    
                    // Product Details
                    showProductDetails: false,
                    selectedProduct: {},
                    selectedSize: '',
                    selectedColor: '',
                    selectedQuantity: 1,
                    
                    // Filters
                    filters: {
                        sort: '',
                        minPrice: '',
                        maxPrice: '',
                        size: '',
                        brand: ''
                    },
                    
                    // Cart
                    cart: JSON.parse(localStorage.getItem('cart') || '[]'),
                    showCart: false,
                    
                    // Chatbot
                    showChatbot: false,
                    chatInput: '',
                    chatMessages: [
                        {
                            id: 1,
                            type: 'bot',
                            text: 'Hello! Welcome to Silk Touch. How can I help you today?'
                        }
                    ],
                    chatLoading: false,
                    chatSessionId: 'session_' + Date.now(),
                    
                    // UI
                    message: null,
                    
                    // Global objects
                    window: window,
                    
                    // Enhanced fallback data with real product images (20 products total)
                    fallbackProducts: [
                        {
                            _id: '1',
                            name: 'Classic White Shirt',
                            description: 'Premium cotton dress shirt perfect for office or formal occasions. Comfortable fit with modern styling and excellent durability.',
                            brand: 'Silk Touch Premium',
                            price: 129,
                            category: 'men',
                            subcategory: 'shirts',
                            rating: 4.5,
                            sizes: ['S', 'M', 'L', 'XL'],
                            colors: ['White', 'Light Blue'],
                            featured: true,
                            stock: 50,
                            tags: ['formal', 'cotton', 'office', 'classic'],
                            image: 'https://images.unsplash.com/photo-1596755094514-f87e34085b2c?w=400&h=600&fit=crop&crop=center'
                        },
                        {
                            _id: '2',
                            name: 'Casual Denim Jeans',
                            description: 'Comfortable straight-fit jeans made from high-quality denim. Perfect for everyday wear with excellent durability.',
                            brand: 'Urban Style',
                            price: 199,
                            category: 'men',
                            subcategory: 'jeans',
                            rating: 4.3,
                            sizes: ['S', 'M', 'L', 'XL'],
                            colors: ['Dark Blue', 'Light Blue', 'Black'],
                            featured: true,
                            stock: 75,
                            tags: ['casual', 'denim', 'comfortable', 'everyday'],
                            image: 'https://images.unsplash.com/photo-1542272604-787c3835535d?w=400&h=600&fit=crop&crop=center'
                        },
                        {
                            _id: '3',
                            name: 'Business Blazer',
                            description: 'Elegant blazer for professional settings. Tailored fit with attention to detail.',
                            brand: 'Executive',
                            price: 399,
                            category: 'men',
                            subcategory: 'blazers',
                            rating: 4.7,
                            sizes: ['S', 'M', 'L', 'XL'],
                            colors: ['Navy', 'Charcoal', 'Black'],
                            featured: false,
                            stock: 30,
                            tags: ['formal', 'business', 'professional', 'tailored'],
                            image: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=400&h=600&fit=crop&crop=center'
                        },
                        {
                            _id: '4',
                            name: 'Cotton T-Shirt',
                            description: 'Soft cotton t-shirt for casual wear. Available in multiple colors and sizes.',
                            brand: 'Comfort Zone',
                            price: 49,
                            category: 'men',
                            subcategory: 'tshirts',
                            rating: 4.2,
                            sizes: ['S', 'M', 'L', 'XL', 'XXL'],
                            colors: ['White', 'Black', 'Gray', 'Navy', 'Red'],
                            featured: false,
                            stock: 100,
                            tags: ['casual', 'cotton', 'basic', 'comfortable'],
                            image: 'https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?w=400&h=600&fit=crop&crop=center'
                        },
                        {
                            _id: '5',
                            name: 'Sports Performance Polo',
                            description: 'Moisture-wicking polo shirt perfect for active lifestyle and sports activities.',
                            brand: 'Active Wear',
                            price: 89,
                            category: 'men',
                            subcategory: 'polos',
                            rating: 4.4,
                            sizes: ['S', 'M', 'L', 'XL'],
                            colors: ['White', 'Navy', 'Red', 'Gray'],
                            featured: false,
                            stock: 65,
                            tags: ['sports', 'active', 'moisture-wicking', 'polo'],
                            image: 'https://images.unsplash.com/photo-1586790170083-2f9ceadc732d?w=400&h=600&fit=crop&crop=center'
                        },
                        {
                            _id: '6',
                            name: 'Winter Wool Sweater',
                            description: 'Premium wool sweater for cold weather. Classic V-neck design with superior warmth.',
                            brand: 'Winter Collection',
                            price: 219,
                            category: 'men',
                            subcategory: 'sweaters',
                            rating: 4.6,
                            sizes: ['S', 'M', 'L', 'XL'],
                            colors: ['Navy', 'Gray', 'Burgundy', 'Black'],
                            featured: true,
                            stock: 35,
                            tags: ['winter', 'wool', 'warm', 'classic'],
                            image: 'https://images.unsplash.com/photo-1576871337622-98d48d1cf531?w=400&h=600&fit=crop&crop=center'
                        },
                        // Women's Clothing
                        {
                            _id: '7',
                            name: 'Elegant Evening Dress',
                            description: 'Stunning evening dress perfect for special occasions. Flattering silhouette with premium fabric.',
                            brand: 'Glamour',
                            price: 299,
                            category: 'women',
                            subcategory: 'dresses',
                            rating: 4.8,
                            sizes: ['XS', 'S', 'M', 'L'],
                            colors: ['Black', 'Navy', 'Burgundy'],
                            featured: true,
                            stock: 25,
                            tags: ['formal', 'evening', 'elegant', 'special occasion'],
                            image: 'https://images.unsplash.com/photo-1566479179817-fb77d2a4b8c9?w=400&h=600&fit=crop&crop=center'
                        },
                        {
                            _id: '8',
                            name: 'Casual Summer Blouse',
                            description: 'Light and airy blouse perfect for summer days. Comfortable and stylish for everyday wear.',
                            brand: 'Summer Breeze',
                            price: 89,
                            category: 'women',
                            subcategory: 'blouses',
                            rating: 4.4,
                            sizes: ['XS', 'S', 'M', 'L', 'XL'],
                            colors: ['White', 'Pink', 'Yellow', 'Light Blue'],
                            featured: true,
                            stock: 60,
                            tags: ['casual', 'summer', 'lightweight', 'comfortable'],
                            image: 'https://images.unsplash.com/photo-1485462537415-ac24221ce21d?w=400&h=600&fit=crop&crop=center'
                        },
                        {
                            _id: '9',
                            name: 'High-Waisted Jeans',
                            description: 'Trendy high-waisted jeans with a flattering fit. Made from stretch denim for comfort.',
                            brand: 'Trendy Fit',
                            price: 179,
                            category: 'women',
                            subcategory: 'jeans',
                            rating: 4.6,
                            sizes: ['XS', 'S', 'M', 'L', 'XL'],
                            colors: ['Dark Blue', 'Light Blue', 'Black'],
                            featured: false,
                            stock: 80,
                            tags: ['trendy', 'high-waisted', 'stretch', 'denim'],
                            image: 'https://images.unsplash.com/photo-1541099649105-f69ad21f3246?w=400&h=600&fit=crop&crop=center'
                        },
                        {
                            _id: '10',
                            name: 'Floral Maxi Dress',
                            description: 'Beautiful floral print maxi dress perfect for summer occasions and casual events.',
                            brand: 'Floral Dreams',
                            price: 169,
                            category: 'women',
                            subcategory: 'dresses',
                            rating: 4.5,
                            sizes: ['XS', 'S', 'M', 'L'],
                            colors: ['Blue Floral', 'Pink Floral', 'White Floral'],
                            featured: true,
                            stock: 35,
                            tags: ['floral', 'maxi', 'summer', 'casual'],
                            image: 'https://images.unsplash.com/photo-1515372039744-b8f02a3ae446?w=400&h=600&fit=crop&crop=center'
                        },
                        {
                            _id: '11',
                            name: 'Knit Sweater',
                            description: 'Cozy knit sweater perfect for cooler weather. Soft and warm with a classic design.',
                            brand: 'Cozy Knits',
                            price: 149,
                            category: 'women',
                            subcategory: 'sweaters',
                            rating: 4.3,
                            sizes: ['XS', 'S', 'M', 'L'],
                            colors: ['Beige', 'Gray', 'Pink', 'Navy'],
                            featured: false,
                            stock: 45,
                            tags: ['cozy', 'knit', 'warm', 'classic'],
                            image: 'https://images.unsplash.com/photo-1434389677669-e08b4cac3105?w=400&h=600&fit=crop&crop=center'
                        },
                        {
                            _id: '12',
                            name: 'Professional Blazer',
                            description: 'Sophisticated blazer designed for the modern professional woman. Perfect for office wear.',
                            brand: 'Career Woman',
                            price: 259,
                            category: 'women',
                            subcategory: 'blazers',
                            rating: 4.7,
                            sizes: ['XS', 'S', 'M', 'L', 'XL'],
                            colors: ['Black', 'Navy', 'Gray', 'Burgundy'],
                            featured: false,
                            stock: 40,
                            tags: ['professional', 'office', 'formal', 'sophisticated'],
                            image: 'https://images.unsplash.com/photo-1594633312681-425c7b97ccd1?w=400&h=600&fit=crop&crop=center'
                        },
                        {
                            _id: '13',
                            name: 'Silk Scarf Collection',
                            description: 'Premium silk scarves in various designs. Perfect accessory for any outfit.',
                            brand: 'Silk Elegance',
                            price: 79,
                            category: 'women',
                            subcategory: 'accessories',
                            rating: 4.2,
                            sizes: ['One Size'],
                            colors: ['Floral Print', 'Abstract Print', 'Solid Navy', 'Solid Red'],
                            featured: false,
                            stock: 50,
                            tags: ['silk', 'accessory', 'elegant', 'versatile'],
                            image: 'https://images.unsplash.com/photo-1617038220319-276d3cfab638?w=400&h=600&fit=crop&crop=center'
                        },
                        // Kids' Clothing
                        {
                            _id: '14',
                            name: 'Kids Colorful T-Shirt',
                            description: 'Fun and colorful t-shirt for active kids. Made from soft, breathable cotton.',
                            brand: 'Little Ones',
                            price: 39,
                            category: 'kids',
                            subcategory: 'tshirts',
                            rating: 4.5,
                            sizes: ['S', 'M', 'L'],
                            colors: ['Rainbow', 'Blue', 'Pink', 'Green'],
                            featured: true,
                            stock: 90,
                            tags: ['kids', 'colorful', 'cotton', 'playful'],
                            image: 'https://images.unsplash.com/photo-1519578922761-228e1b73de71?w=400&h=600&fit=crop&crop=center'
                        },
                        {
                            _id: '15',
                            name: 'School Uniform Polo',
                            description: 'Classic polo shirt suitable for school uniforms. Durable and comfortable for daily wear.',
                            brand: 'School Style',
                            price: 59,
                            category: 'kids',
                            subcategory: 'polos',
                            rating: 4.1,
                            sizes: ['S', 'M', 'L'],
                            colors: ['Navy', 'White', 'Light Blue'],
                            featured: false,
                            stock: 70,
                            tags: ['school', 'uniform', 'polo', 'durable'],
                            image: 'https://images.unsplash.com/photo-1503944583220-79d8926ad5e2?w=400&h=600&fit=crop&crop=center'
                        },
                        {
                            _id: '16',
                            name: 'Kids Denim Jacket',
                            description: 'Stylish denim jacket for kids. Perfect layering piece for any outfit.',
                            brand: 'Junior Fashion',
                            price: 99,
                            category: 'kids',
                            subcategory: 'jackets',
                            rating: 4.4,
                            sizes: ['S', 'M', 'L'],
                            colors: ['Light Blue', 'Dark Blue'],
                            featured: false,
                            stock: 40,
                            tags: ['kids', 'denim', 'jacket', 'layering'],
                            image: 'https://images.unsplash.com/photo-1503944583220-79d8926ad5e2?w=400&h=600&fit=crop&crop=center'
                        },
                        {
                            _id: '17',
                            name: 'Playtime Dress',
                            description: 'Comfortable dress for girls, perfect for playtime and casual occasions.',
                            brand: 'Play & Fun',
                            price: 69,
                            category: 'kids',
                            subcategory: 'dresses',
                            rating: 4.6,
                            sizes: ['S', 'M', 'L'],
                            colors: ['Pink', 'Purple', 'Yellow'],
                            featured: true,
                            stock: 55,
                            tags: ['kids', 'dress', 'playtime', 'comfortable'],
                            image: 'https://images.unsplash.com/photo-1518396745084-d0d9e34c7e8a?w=400&h=600&fit=crop&crop=center'
                        },
                        {
                            _id: '18',
                            name: 'Kids Sports Shorts',
                            description: 'Comfortable athletic shorts for active kids. Perfect for sports and outdoor activities.',
                            brand: 'Active Kids',
                            price: 45,
                            category: 'kids',
                            subcategory: 'shorts',
                            rating: 4.3,
                            sizes: ['S', 'M', 'L'],
                            colors: ['Blue', 'Red', 'Black', 'Green'],
                            featured: false,
                            stock: 80,
                            tags: ['kids', 'sports', 'active', 'shorts'],
                            image: 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=400&h=600&fit=crop&crop=center'
                        },
                        {
                            _id: '19',
                            name: 'Winter Kids Hoodie',
                            description: 'Warm and cozy hoodie for kids. Soft fleece lining for extra comfort during cold weather.',
                            brand: 'Cozy Kids',
                            price: 89,
                            category: 'kids',
                            subcategory: 'hoodies',
                            rating: 4.4,
                            sizes: ['S', 'M', 'L'],
                            colors: ['Gray', 'Navy', 'Pink', 'Red'],
                            featured: false,
                            stock: 60,
                            tags: ['kids', 'winter', 'hoodie', 'warm'],
                            image: 'https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=400&h=600&fit=crop&crop=center'
                        },
                        {
                            _id: '20',
                            name: 'Kids Formal Suit Set',
                            description: 'Complete formal suit set for special occasions. Includes jacket, pants, and shirt.',
                            brand: 'Little Gentleman',
                            price: 189,
                            category: 'kids',
                            subcategory: 'formal',
                            rating: 4.7,
                            sizes: ['S', 'M', 'L'],
                            colors: ['Navy', 'Black', 'Gray'],
                            featured: true,
                            stock: 25,
                            tags: ['kids', 'formal', 'suit', 'special occasion'],
                            image: 'https://images.unsplash.com/photo-1519085360753-af0119f7cbe7?w=400&h=600&fit=crop&crop=center'
                        }
                    ]
                }
            },
            
            computed: {
                cartItemsCount() {
                    return this.cart.reduce((total, item) => total + item.quantity, 0);
                },
                
                cartTotal() {
                    return this.cart.reduce((total, item) => total + (item.price * item.quantity), 0);
                }
            },
            
            async mounted() {
                // Check API connectivity first
                await this.checkApiConnection();
                
                // Setup axios defaults after connection check
                if (this.apiConnected) {
                    axios.defaults.baseURL = this.baseURL;
                    if (this.token) {
                        axios.defaults.headers.common['Authorization'] = `Bearer ${this.token}`;
                    }
                    
                    // Check if user is logged in
                    if (this.token) {
                        await this.loadUserProfile();
                    }
                }
                
                // Load initial products (will use fallback if API not connected)
                await this.loadProducts();
            },
            
            methods: {
                // API Connection Check with multiple URL attempts
                async checkApiConnection() {
                    const possibleUrls = [
                        'http://localhost:5000/api',
                        'http://127.0.0.1:5000/api',
                        'http://0.0.0.0:5000/api'
                    ];

                    for (const url of possibleUrls) {
                        try {
                            console.log(`🔍 Trying API connection: ${url}`);
                            
                            // Create a temporary axios instance for testing
                            const testResponse = await axios.get(`${url}/products?limit=1`, { 
                                timeout: 3000,
                                baseURL: undefined // Don't use any baseURL for this test
                            });
                            
                            // If successful, set the working URL
                            this.baseURL = url;
                            this.apiConnected = true;
                            
                            // Update axios defaults for all future requests
                            axios.defaults.baseURL = url;
                            
                            console.log(`✅ Connected to Silk Touch API at ${url}`);
                            console.log(`📦 API Response:`, testResponse.data);
                            return;
                            
                        } catch (error) {
                            console.log(`❌ Failed to connect to ${url}:`, error.message);
                            continue;
                        }
                    }
                    
                    // If all connections failed
                    this.apiConnected = false;
                    axios.defaults.baseURL = ''; // Clear any baseURL
                    console.warn('⚠️ All API connection attempts failed, using demo mode');
                    console.log('🔧 Make sure your backend is running on port 5000');
                    this.showMessage('Demo Mode: Backend API not connected. Showing sample products.', 'error');
                },
                
                // Handle image loading errors
                handleImageError(event) {
                    event.target.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjYwMCIgdmlld0JveD0iMCAwIDQwMCA2MDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI0MDAiIGhlaWdodD0iNjAwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik0yMDAgMzAwQzIyNy42MTQgMzAwIDI1MCAyNzcuNjE0IDI1MCAyNTBDMjUwIDIyMi4zODYgMjI3LjYxNCAyMDAgMjAwIDIwMEMxNzIuMzg2IDIwMCAxNTAgMjIyLjM4NiAxNTAgMjUwQzE1MCAyNzcuNjE0IDE3Mi4zODYgMzAwIDIwMCAzMDBaIiBmaWxsPSIjOUNBM0FGIi8+CjxwYXRoIGQ9Ik0yMDAgMzUwQzE2MS4zNCAzNTAgMTMwIDMxOC42NiAxMzAgMjgwQzEzMCAyNDEuMzQgMTYxLjM0IDIxMCAyMDAgMjEwQzIzOC42NiAyMTAgMjcwIDI0MS4zNCAyNzAgMjgwQzI3MCAzMTguNjYgMjM4LjY2IDM1MCAyMDAgMzUwWiIgc3Ryb2tlPSIjOUNBM0FGIiBzdHJva2Utd2lkdGg9IjIiLz4KPC9zdmc+';
                },
                
                // Authentication Methods
                async handleAuth() {
                    if (!this.apiConnected) {
                        this.authError = 'Authentication requires backend connection. Currently in demo mode.';
                        return;
                    }
                    
                    try {
                        this.authError = '';
                        const endpoint = this.loginMode === 'login' ? '/auth/login' : '/auth/register';
                        const data = this.loginMode === 'login' 
                            ? { email: this.authForm.email, password: this.authForm.password }
                            : this.authForm;
                        
                        const response = await axios.post(endpoint, data);
                        
                        this.token = response.data.token;
                        this.user = response.data.user;
                        
                        localStorage.setItem('token', this.token);
                        axios.defaults.headers.common['Authorization'] = `Bearer ${this.token}`;
                        
                        this.showLogin = false;
                        this.authForm = { name: '', email: '', password: '' };
                        this.showMessage('Welcome to Silk Touch!', 'success');
                        
                    } catch (error) {
                        this.authError = error.response?.data?.message || 'Authentication failed';
                    }
                },
                
                async loadUserProfile() {
                    try {
                        const response = await axios.get('/profile');
                        this.user = response.data;
                    } catch (error) {
                        this.logout();
                    }
                },
                
                logout() {
                    this.user = null;
                    this.token = null;
                    localStorage.removeItem('token');
                    delete axios.defaults.headers.common['Authorization'];
                    this.showMessage('Logged out successfully', 'success');
                },
                
                toggleLoginMode() {
                    this.loginMode = this.loginMode === 'login' ? 'register' : 'login';
                    this.authError = '';
                },
                
                // Product Methods
                async loadProducts() {
                    this.loading = true;
                    
                    if (!this.apiConnected) {
                        // Use fallback data when API is not available
                        await new Promise(resolve => setTimeout(resolve, 500)); // Simulate loading
                        
                        let filteredProducts = [...this.fallbackProducts];
                        
                        // Apply category filter
                        if (this.currentCategory) {
                            filteredProducts = filteredProducts.filter(p => p.category === this.currentCategory);
                        }
                        
                        // Apply search filter
                        if (this.searchQuery) {
                            const query = this.searchQuery.toLowerCase();
                            filteredProducts = filteredProducts.filter(p => 
                                p.name.toLowerCase().includes(query) || 
                                p.brand.toLowerCase().includes(query)
                            );
                        }
                        
                        // Apply price filter
                        if (this.filters.minPrice) {
                            filteredProducts = filteredProducts.filter(p => p.price >= parseInt(this.filters.minPrice));
                        }
                        if (this.filters.maxPrice) {
                            filteredProducts = filteredProducts.filter(p => p.price <= parseInt(this.filters.maxPrice));
                        }
                        
                        // Apply sorting
                        if (this.filters.sort) {
                            switch (this.filters.sort) {
                                case 'price_low':
                                    filteredProducts.sort((a, b) => a.price - b.price);
                                    break;
                                case 'price_high':
                                    filteredProducts.sort((a, b) => b.price - a.price);
                                    break;
                                case 'rating':
                                    filteredProducts.sort((a, b) => b.rating - a.rating);
                                    break;
                            }
                        }
                        
                        this.products = filteredProducts;
                        this.totalProducts = filteredProducts.length;
                        this.totalPages = Math.ceil(filteredProducts.length / 12);
                        this.loading = false;
                        return;
                    }
                    
                    try {
                        const params = {
                            page: this.currentPage,
                            limit: 12,
                            ...this.filters
                        };
                        
                        if (this.currentCategory) {
                            params.category = this.currentCategory;
                        }
                        
                        if (this.searchQuery) {
                            params.search = this.searchQuery;
                        }

                        console.log('🌐 Making API request to:', `${this.baseURL}/products`);
                        console.log('📝 With params:', params);
                        
                        // Make the API call with explicit URL
                        const response = await axios.get(`${this.baseURL}/products`, { 
                            params,
                            timeout: 5000
                        });
                        
                        console.log('✅ API Response received:', response.data);
                        
                        this.products = response.data.products || [];
                        this.totalPages = response.data.totalPages || 1;
                        this.totalProducts = response.data.total || 0;
                        
                    } catch (error) {
                        console.error('❌ Failed to load products from API:', error);
                        this.showMessage('Failed to load products from server, using demo mode', 'error');
                        this.apiConnected = false;
                        await this.loadProducts(); // Retry with fallback data
                    } finally {
                        this.loading = false;
                    }
                },
                
                setCategory(category) {
                    this.currentCategory = category;
                    this.currentPage = 1;
                    this.currentView = 'products';
                    this.loadProducts();
                },
                
                changePage(page) {
                    if (page >= 1 && page <= this.totalPages) {
                        this.currentPage = page;
                        this.loadProducts();
                    }
                },
                
                viewProduct(product) {
                    this.selectedProduct = { ...product };
                    this.selectedSize = product.sizes ? product.sizes[0] : '';
                    this.selectedColor = product.colors ? product.colors[0] : '';
                    this.selectedQuantity = 1;
                    this.showProductDetails = true;
                },
                
                addToCartFromDetails() {
                    const productToAdd = {
                        ...this.selectedProduct,
                        selectedSize: this.selectedSize,
                        selectedColor: this.selectedColor,
                        selectedQuantity: this.selectedQuantity
                    };
                    
                    this.addToCart(productToAdd, this.selectedQuantity);
                    this.showProductDetails = false;
                },
                
                // Search Methods
                async handleSearch() {
                    if (!this.apiConnected) {
                        // Provide basic suggestions from fallback data
                        if (this.searchQuery.length > 2) {
                            const query = this.searchQuery.toLowerCase();
                            this.suggestions = this.fallbackProducts
                                .filter(p => p.name.toLowerCase().includes(query))
                                .map(p => p.name)
                                .slice(0, 5);
                        } else {
                            this.suggestions = [];
                        }
                        return;
                    }
                    
                    if (this.searchQuery.length > 2) {
                        try {
                            const response = await axios.get(`${this.baseURL}/search/suggestions`, {
                                params: { q: this.searchQuery },
                                timeout: 3000
                            });
                            this.suggestions = response.data;
                        } catch (error) {
                            console.error('Search suggestions error:', error);
                            this.suggestions = [];
                        }
                    } else {
                        this.suggestions = [];
                    }
                },
                
                selectSuggestion(suggestion) {
                    this.searchQuery = suggestion;
                    this.suggestions = [];
                    this.performSearch();
                },
                
                performSearch() {
                    this.suggestions = [];
                    this.currentPage = 1;
                    this.currentView = 'products';
                    this.loadProducts();
                },
                
                // Cart Methods
                addToCart(product, quantity = 1) {
                    const existingItem = this.cart.find(item => 
                        item.id === product._id && 
                        item.size === (product.selectedSize || product.sizes?.[0]) &&
                        item.color === (product.selectedColor || product.colors?.[0])
                    );
                    
                    if (existingItem) {
                        existingItem.quantity += quantity;
                    } else {
                        this.cart.push({
                            id: product._id,
                            name: product.name,
                            brand: product.brand,
                            price: product.price,
                            quantity: quantity,
                            size: product.selectedSize || product.sizes?.[0] || null,
                            color: product.selectedColor || product.colors?.[0] || null
                        });
                    }
                    
                    localStorage.setItem('cart', JSON.stringify(this.cart));
                    this.showMessage(`${product.name} added to cart!`, 'success');
                },
                
                updateQuantity(item, newQuantity) {
                    if (newQuantity <= 0) {
                        this.removeFromCart(item);
                    } else {
                        item.quantity = newQuantity;
                        localStorage.setItem('cart', JSON.stringify(this.cart));
                    }
                },
                
                removeFromCart(item) {
                    const index = this.cart.findIndex(cartItem => cartItem.id === item.id);
                    if (index > -1) {
                        this.cart.splice(index, 1);
                        localStorage.setItem('cart', JSON.stringify(this.cart));
                        this.showMessage('Item removed from cart', 'success');
                    }
                },
                
                async checkout() {
                    if (!this.user) {
                        this.showCart = false;
                        this.showLogin = true;
                        this.showMessage('Please login to checkout', 'error');
                        return;
                    }
                    
                    this.showMessage('Checkout functionality coming soon!', 'success');
                },
                
                // Chatbot Methods
                toggleChatbot() {
                    this.showChatbot = !this.showChatbot;
                    if (this.showChatbot) {
                        this.$nextTick(() => {
                            this.scrollChatToBottom();
                        });
                    }
                },
                
                async sendMessage() {
                    if (!this.chatInput.trim()) return;
                    
                    const userMessage = {
                        id: Date.now(),
                        type: 'user',
                        text: this.chatInput
                    };
                    
                    this.chatMessages.push(userMessage);
                    const query = this.chatInput;
                    this.chatInput = '';
                    this.chatLoading = true;
                    
                    this.$nextTick(() => {
                        this.scrollChatToBottom();
                    });
                    
                    if (!this.apiConnected) {
                        // Provide basic chatbot responses for demo mode
                        await new Promise(resolve => setTimeout(resolve, 1000)); // Simulate thinking
                        
                        let response = "I'm currently in demo mode since the backend API isn't connected. ";
                        const queryLower = query.toLowerCase();
                        
                        if (queryLower.includes('price') || queryLower.includes('cost')) {
                            response += "Our products range from AED 39 to AED 399. You can see all prices on the products page!";
                        } else if (queryLower.includes('size') || queryLower.includes('sizing')) {
                            response += "We offer sizes from XS to XXL depending on the product. Check individual product pages for available sizes.";
                        } else if (queryLower.includes('shipping') || queryLower.includes('delivery')) {
                            response += "We offer free shipping on orders over AED 200. Standard delivery takes 3-7 business days across the UAE.";
                        } else if (queryLower.includes('return')) {
                            response += "We have a 30-day return policy for unworn items with tags. Returns are easy and hassle-free!";
                        } else {
                            response += "I can help you with questions about our products, pricing, sizes, shipping, and returns. What would you like to know?";
                        }
                        
                        const botMessage = {
                            id: Date.now() + 1,
                            type: 'bot',
                            text: response
                        };
                        
                        this.chatMessages.push(botMessage);
                        this.chatLoading = false;
                        this.$nextTick(() => {
                            this.scrollChatToBottom();
                        });
                        return;
                    }
                    
                    try {
                        const response = await axios.post(`${this.baseURL}/chatbot/query`, {
                            query: query,
                            sessionId: this.chatSessionId,
                            context: this.chatMessages.slice(-6).map(msg => ({
                                role: msg.type === 'user' ? 'user' : 'assistant',
                                content: msg.text
                            }))
                        }, {
                            timeout: 10000
                        });
                        
                        const botMessage = {
                            id: Date.now() + 1,
                            type: 'bot',
                            text: response.data.response
                        };
                        
                        this.chatMessages.push(botMessage);
                        
                    } catch (error) {
                        console.error('Chatbot API error:', error);
                        const errorMessage = {
                            id: Date.now() + 1,
                            type: 'bot',
                            text: 'Sorry, I\'m having trouble connecting to my AI brain right now. Please try again later or browse our website directly for product information.'
                        };
                        
                        this.chatMessages.push(errorMessage);
                    } finally {
                        this.chatLoading = false;
                        this.$nextTick(() => {
                            this.scrollChatToBottom();
                        });
                    }
                },
                
                scrollChatToBottom() {
                    const chatMessages = this.$refs.chatMessages;
                    if (chatMessages) {
                        chatMessages.scrollTop = chatMessages.scrollHeight;
                    }
                },
                
                // Utility Methods
                async retryConnection() {
                    console.log('🔄 Retrying API connection...');
                    this.loading = true;
                    
                    // Reset connection state
                    this.apiConnected = false;
                    axios.defaults.baseURL = '';
                    
                    // Try to reconnect
                    await this.checkApiConnection();
                    
                    if (this.apiConnected) {
                        // Set up authentication if we have a token
                        if (this.token) {
                            axios.defaults.headers.common['Authorization'] = `Bearer ${this.token}`;
                        }
                        
                        await this.loadProducts();
                        this.showMessage('✅ Connected to backend successfully!', 'success');
                    } else {
                        await this.loadProducts(); // This will load fallback data
                        this.showMessage('❌ Still unable to connect to backend', 'error');
                    }
                    
                    this.loading = false;
                },
                
                showMessage(text, type = 'success') {
                    this.message = { text, type };
                    setTimeout(() => {
                        this.message = null;
                    }, 5000); // Show for 5 seconds
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
