<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Silk Touch - Modern Fashion E-commerce</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ‘•</text></svg>">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.4.21/vue.global.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.0/axios.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="app">
        <!-- Header -->
        <header class="header">
            <div class="container">
                <nav class="nav">
                    <a href="#" class="logo" @click="setActiveView('home')">
                        <i class="fas fa-tshirt"></i>
                        Silk Touch
                        <span v-if="!apiConnected" style="font-size: 0.6rem; background: #ff4757; padding: 2px 6px; border-radius: 10px; margin-left: 10px;">DEMO</span>
                    </a>
                    
                    <div class="search-container">
                        <input 
                            v-model="searchQuery" 
                            @input="handleSearch"
                            @keyup.enter="performSearch"
                            type="text" 
                            placeholder="Search for clothing..."
                            class="search-input"
                        />
                        <button @click="performSearch" class="search-btn">
                            <i class="fas fa-search"></i>
                        </button>
                        
                        <div v-if="suggestions.length > 0" class="search-suggestions">
                            <div 
                                v-for="suggestion in suggestions" 
                                :key="suggestion"
                                @click="selectSuggestion(suggestion)"
                                class="suggestion-item"
                            >
                                {{ suggestion }}
                            </div>
                        </div>
                    </div>
                    
                    <div class="nav-actions">
                        <button v-if="!apiConnected" @click="retryConnection" class="btn btn-secondary" style="margin-right: 1rem;">
                            <i class="fas fa-sync"></i>
                            Retry API
                        </button>
                        
                        <button v-if="!user" @click="showLogin = true" class="btn btn-secondary">
                            <i class="fas fa-sign-in-alt"></i>
                            Login
                        </button>
                        
                        <div v-if="user" class="user-menu">
                            <span>Welcome, {{ user.name }}!</span>
                            <button @click="setActiveView('profile')" class="btn btn-secondary">
                                <i class="fas fa-user"></i>
                                Profile
                            </button>
                            <button v-if="user.role === 'admin'" @click="setActiveView('admin')" class="btn btn-secondary">
                                <i class="fas fa-cog"></i>
                                Admin
                            </button>
                            <button @click="logout" class="btn btn-secondary">
                                <i class="fas fa-sign-out-alt"></i>
                                Logout
                            </button>
                        </div>
                        
                        <button @click="showCart = true" class="btn btn-primary" style="position: relative;">
                            <i class="fas fa-shopping-cart"></i>
                            Cart
                            <span v-if="cartItemsCount > 0" class="cart-badge">{{ cartItemsCount }}</span>
                        </button>
                    </div>
                </nav>
            </div>
        </header>

        <!-- Category Navigation -->
        <nav class="category-nav">
            <div class="container">
                <div class="category-links">
                    <a href="#" @click="setCategory('')" :class="{ active: currentCategory === '' }" class="category-link">
                        All Products
                    </a>
                    <a href="#" @click="setCategory('men')" :class="{ active: currentCategory === 'men' }" class="category-link">
                        Men
                    </a>
                    <a href="#" @click="setCategory('women')" :class="{ active: currentCategory === 'women' }" class="category-link">
                        Women
                    </a>
                    <a href="#" @click="setCategory('kids')" :class="{ active: currentCategory === 'kids' }" class="category-link">
                        Kids
                    </a>
                    <a v-if="user" href="#" @click="setActiveView('orders')" :class="{ active: activeView === 'orders' }" class="category-link">
                        My Orders
                    </a>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <div class="container">
                <!-- Home View -->
                <div v-if="activeView === 'home'">
                    <!-- Hero Section -->
                    <section class="hero">
                        <h1>Welcome to Silk Touch</h1>
                        <p>Discover the latest fashion trends for the whole family</p>
                        <button @click="setCategory('')" class="btn btn-primary">
                            Shop Now
                        </button>
                    </section>

                    <!-- Featured Products -->
                    <section v-if="featuredProducts.length > 0" class="featured-section">
                        <div class="section-header">
                            <h2 class="section-title">Featured Products</h2>
                            <button @click="setCategory(''); setActiveView('products')" class="btn btn-outline">
                                View All Products
                            </button>
                        </div>
                        
                        <div class="products-grid">
                            <div v-for="product in featuredProducts" :key="product._id" class="product-card">
                                <div class="product-image">
                                    <img 
                                        :src="product.image" 
                                        :alt="product.name"
                                        @error="handleImageError"
                                    />
                                    <div class="product-badges">
                                        <span class="badge badge-featured">Featured</span>
                                    </div>
                                </div>
                                <div class="product-info">
                                    <div class="product-brand">{{ product.brand }}</div>
                                    <div class="product-name">{{ product.name }}</div>
                                    <div class="product-rating">
                                        <div class="stars">
                                            <i v-for="i in 5" :key="i" :class="['fas', i <= product.rating ? 'fa-star' : 'fa-star-o']"></i>
                                        </div>
                                        <span>({{ product.rating }})</span>
                                    </div>
                                    <div class="product-price">AED {{ product.price }}</div>
                                    <div class="product-actions">
                                        <button @click="addToCart(product)" class="btn-add-cart">
                                            <i class="fas fa-plus"></i>
                                            Add to Cart
                                        </button>
                                        <button @click="viewProduct(product)" class="btn-view">
                                            <i class="fas fa-eye"></i>
                                            View
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                    
                    <!-- Products Section -->
                    <section class="products-container">
                        <div class="products-header">
                            <h2>{{ currentCategory ? currentCategory.charAt(0).toUpperCase() + currentCategory.slice(1) + "'s" : "All" }} Collection</h2>
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <p>{{ totalProducts }} products found</p>
                            </div>
                        </div>

                        <!-- Filters -->
                        <div class="filters">
                            <div class="filter-grid">
                                <div class="filter-group">
                                    <label>Sort By</label>
                                    <select v-model="filters.sort" @change="loadProducts" class="filter-input">
                                        <option value="">Default</option>
                                        <option value="price_low">Price: Low to High</option>
                                        <option value="price_high">Price: High to Low</option>
                                        <option value="newest">Newest</option>
                                        <option value="rating">Rating</option>
                                    </select>
                                </div>
                                
                                <div class="filter-group">
                                    <label>Price Range</label>
                                    <div style="display: flex; gap: 0.5rem;">
                                        <input 
                                            v-model="filters.minPrice" 
                                            @input="debounceLoadProducts"
                                            type="number" 
                                            placeholder="Min"
                                            class="filter-input"
                                        />
                                        <input 
                                            v-model="filters.maxPrice" 
                                            @input="debounceLoadProducts"
                                            type="number" 
                                            placeholder="Max"
                                            class="filter-input"
                                        />
                                    </div>
                                </div>
                                
                                <div class="filter-group">
                                    <label>Size</label>
                                    <select v-model="filters.size" @change="loadProducts" class="filter-input">
                                        <option value="">All Sizes</option>
                                        <option v-for="size in availableSizes" :key="size" :value="size">{{ size }}</option>
                                    </select>
                                </div>
                                
                                <div class="filter-group">
                                    <label>Brand</label>
                                    <select v-model="filters.brand" @change="loadProducts" class="filter-input">
                                        <option value="">All Brands</option>
                                        <option v-for="brand in availableBrands" :key="brand" :value="brand">{{ brand }}</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div v-if="loading" class="loading">
                            <div class="spinner"></div>
                            <p style="margin-top: 1rem;">
                                {{ apiConnected ? 'Loading products from server...' : 'Loading demo products...' }}
                            </p>
                        </div>
                        
                        <div v-else class="products-grid">
                            <div v-for="product in products" :key="product._id" class="product-card">
                                <div class="product-image">
                                    <img 
                                        :src="product.image" 
                                        :alt="product.name"
                                        @error="handleImageError"
                                    />
                                    <div class="product-badges">
                                        <span v-if="product.featured" class="badge badge-featured">Featured</span>
                                        <span v-if="product.stock < 10" class="badge badge-low-stock">Low Stock</span>
                                    </div>
                                </div>
                                <div class="product-info">
                                    <div class="product-brand">{{ product.brand }}</div>
                                    <div class="product-name">{{ product.name }}</div>
                                    <div class="product-rating">
                                        <div class="stars">
                                            <i v-for="i in 5" :key="i" :class="['fas', i <= product.rating ? 'fa-star' : 'fa-star-o']"></i>
                                        </div>
                                        <span>({{ product.rating }})</span>
                                    </div>
                                    <div class="product-price">AED {{ product.price }}</div>
                                    <div class="product-actions">
                                        <button @click="addToCart(product)" class="btn-add-cart">
                                            <i class="fas fa-plus"></i>
                                            Add to Cart
                                        </button>
                                        <button @click="viewProduct(product)" class="btn-view">
                                            <i class="fas fa-eye"></i>
                                            View
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Pagination -->
                        <div v-if="totalPages > 1" class="pagination">
                            <button 
                                @click="changePage(currentPage - 1)" 
                                :disabled="currentPage === 1"
                                class="page-btn"
                            >
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            
                            <button 
                                v-for="page in visiblePages" 
                                :key="page"
                                @click="changePage(page)"
                                :class="{ active: page === currentPage }"
                                class="page-btn"
                            >
                                {{ page }}
                            </button>
                            
                            <button 
                                @click="changePage(currentPage + 1)" 
                                :disabled="currentPage === totalPages"
                                class="page-btn"
                            >
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </section>
                </div>

                <!-- Profile View -->
                <div v-if="activeView === 'profile' && user" class="profile-section">
                    <h2 style="margin-bottom: 2rem;">My Profile</h2>
                    
                    <form @submit.prevent="updateProfile">
                        <div class="profile-grid">
                            <div class="form-group">
                                <label>Name</label>
                                <input v-model="profileForm.name" type="text" required />
                            </div>
                            
                            <div class="form-group">
                                <label>Email</label>
                                <input v-model="profileForm.email" type="email" required />
                            </div>
                            
                            <div class="form-group">
                                <label>Phone</label>
                                <input v-model="profileForm.phone" type="tel" />
                            </div>
                            
                            <div class="form-group">
                                <label>Country</label>
                                <input v-model="profileForm.address.country" type="text" />
                            </div>
                            
                            <div class="address-section">
                                <h3 style="margin-bottom: 1rem;">Address</h3>
                                <div class="form-group">
                                    <label>Street Address</label>
                                    <input v-model="profileForm.address.street" type="text" />
                                </div>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                    <div class="form-group">
                                        <label>City</label>
                                        <input v-model="profileForm.address.city" type="text" />
                                    </div>
                                    <div class="form-group">
                                        <label>Postal Code</label>
                                        <input v-model="profileForm.address.postalCode" type="text" />
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div v-if="profileError" class="alert alert-error">
                            {{ profileError }}
                        </div>
                        
                        <button type="submit" class="btn btn-primary" style="margin-top: 1rem;">
                            <i class="fas fa-save"></i>
                            Update Profile
                        </button>
                    </form>
                </div>

                <!-- Orders View -->
                <div v-if="activeView === 'orders' && user" class="orders-section">
                    <h2 style="margin-bottom: 2rem;">My Orders</h2>
                    
                    <div v-if="loadingOrders" class="loading">
                        <div class="spinner"></div>
                        <p>Loading your orders...</p>
                    </div>
                    
                    <div v-else-if="orders.length === 0" style="text-align: center; padding: 3rem;">
                        <i class="fas fa-shopping-bag" style="font-size: 3rem; color: #ddd; margin-bottom: 1rem;"></i>
                        <p>You haven't placed any orders yet.</p>
                        <button @click="setActiveView('home')" class="btn btn-primary" style="margin-top: 1rem;">
                            Start Shopping
                        </button>
                    </div>
                    
                    <div v-else>
                        <div v-for="order in orders" :key="order._id" class="order-item">
                            <div class="order-header">
                                <div>
                                    <div class="order-id">Order #{{ order._id.slice(-8).toUpperCase() }}</div>
                                    <div style="font-size: 0.9rem; color: #666; margin-top: 0.25rem;">
                                        {{ formatDate(order.orderDate) }}
                                    </div>
                                </div>
                                <span :class="['order-status', 'status-' + order.status]">
                                    {{ order.status }}
                                </span>
                            </div>
                            
                            <div class="order-items">
                                <div v-for="item in order.items" :key="item._id" class="order-item-row">
                                    <div>
                                        <strong>{{ item.product?.name || 'Product' }}</strong>
                                        <div style="font-size: 0.8rem; color: #666;">
                                            Qty: {{ item.quantity }} 
                                            <span v-if="item.size"> | Size: {{ item.size }}</span>
                                            <span v-if="item.color"> | Color: {{ item.color }}</span>
                                        </div>
                                    </div>
                                    <div style="font-weight: bold;">AED {{ item.price * item.quantity }}</div>
                                </div>
                            </div>
                            
                            <div class="order-total">
                                Total: AED {{ order.totalAmount }}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Admin View -->
                <div v-if="activeView === 'admin' && user?.role === 'admin'">
                    <h2 style="margin-bottom: 2rem;">Admin Dashboard</h2>
                    
                    <!-- Navigation Tabs -->
                    <div class="nav-tabs">
                        <button 
                            @click="adminActiveTab = 'overview'" 
                            :class="{ active: adminActiveTab === 'overview' }"
                            class="nav-tab"
                        >
                            Overview
                        </button>
                        <button 
                            @click="adminActiveTab = 'products'" 
                            :class="{ active: adminActiveTab === 'products' }"
                            class="nav-tab"
                        >
                            Products
                        </button>
                        <button 
                            @click="adminActiveTab = 'orders'" 
                            :class="{ active: adminActiveTab === 'orders' }"
                            class="nav-tab"
                        >
                            Orders
                        </button>
                        <button 
                            @click="adminActiveTab = 'users'" 
                            :class="{ active: adminActiveTab === 'users' }"
                            class="nav-tab"
                        >
                            Users
                        </button>
                        <button 
                            @click="adminActiveTab = 'chatbot'" 
                            :class="{ active: adminActiveTab === 'chatbot' }"
                            class="nav-tab"
                        >
                            Chatbot
                        </button>
                    </div>

                    <!-- Overview Tab -->
                    <div v-if="adminActiveTab === 'overview'">
                        <div v-if="loadingAnalytics" class="loading">
                            <div class="spinner"></div>
                            <p>Loading analytics...</p>
                        </div>
                        
                        <div v-else>
                            <div class="admin-dashboard">
                                <div class="stat-card">
                                    <span class="stat-number">{{ analytics.totalUsers || 0 }}</span>
                                    <span class="stat-label">Total Users</span>
                                </div>
                                <div class="stat-card">
                                    <span class="stat-number">{{ analytics.totalProducts || 0 }}</span>
                                    <span class="stat-label">Total Products</span>
                                </div>
                                <div class="stat-card">
                                    <span class="stat-number">{{ analytics.totalOrders || 0 }}</span>
                                    <span class="stat-label">Total Orders</span>
                                </div>
                                <div class="stat-card">
                                    <span class="stat-number">AED {{ analytics.totalRevenue || 0 }}</span>
                                    <span class="stat-label">Total Revenue</span>
                                </div>
                            </div>
                            
                            <!-- Recent Orders -->
                            <div class="data-table" style="margin-bottom: 2rem;">
                                <div class="table-header">Recent Orders</div>
                                <div v-for="order in analytics.recentOrders" :key="order._id" class="table-row">
                                    <div>
                                        <strong>#{{ order._id.slice(-8).toUpperCase() }}</strong>
                                        <div style="font-size: 0.8rem; color: #666;">{{ order.user?.name }}</div>
                                    </div>
                                    <div>AED {{ order.totalAmount }}</div>
                                    <div>
                                        <span :class="['order-status', 'status-' + order.status]">
                                            {{ order.status }}
                                        </span>
                                    </div>
                                    <div>{{ formatDate(order.orderDate) }}</div>
                                </div>
                            </div>
                            
                            <!-- Popular Products -->
                            <div class="data-table">
                                <div class="table-header">Popular Products</div>
                                <div v-for="item in analytics.popularProducts" :key="item._id" class="table-row">
                                    <div>
                                        <strong>{{ item.product?.name }}</strong>
                                        <div style="font-size: 0.8rem; color: #666;">{{ item.product?.brand }}</div>
                                    </div>
                                    <div>{{ item.totalSold }} sold</div>
                                    <div>AED {{ item.product?.price }}</div>
                                    <div>{{ item.product?.category }}</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Products Tab -->
                    <div v-if="adminActiveTab === 'products'">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                            <h3>Product Management</h3>
                            <button @click="showAddProduct = true" class="btn btn-primary">
                                <i class="fas fa-plus"></i>
                                Add Product
                            </button>
                        </div>
                        
                        <div class="data-table">
                            <div class="table-header">All Products</div>
                            <div v-for="product in products" :key="product._id" class="table-row">
                                <div>
                                    <strong>{{ product.name }}</strong>
                                    <div style="font-size: 0.8rem; color: #666;">{{ product.brand }}</div>
                                </div>
                                <div>AED {{ product.price }}</div>
                                <div>{{ product.stock }} in stock</div>
                                <div class="table-actions">
                                    <button @click="editProduct(product)" class="btn btn-small btn-outline">
                                        <i class="fas fa-edit"></i>
                                        Edit
                                    </button>
                                    <button @click="deleteProduct(product._id)" class="btn btn-small btn-danger">
                                        <i class="fas fa-trash"></i>
                                        Delete
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Orders Tab -->
                    <div v-if="adminActiveTab === 'orders'">
                        <h3 style="margin-bottom: 2rem;">Order Management</h3>
                        
                        <div v-if="loadingAdminOrders" class="loading">
                            <div class="spinner"></div>
                            <p>Loading orders...</p>
                        </div>
                        
                        <div v-else class="data-table">
                            <div class="table-header">All Orders</div>
                            <div v-for="order in adminOrders" :key="order._id" class="table-row">
                                <div>
                                    <strong>#{{ order._id.slice(-8).toUpperCase() }}</strong>
                                    <div style="font-size: 0.8rem; color: #666;">{{ order.user?.name }} ({{ order.user?.email }})</div>
                                </div>
                                <div>AED {{ order.totalAmount }}</div>
                                <div>
                                    <select 
                                        v-model="order.status" 
                                        @change="updateOrderStatus(order._id, order.status)"
                                        class="filter-input"
                                        style="max-width: 120px;"
                                    >
                                        <option value="pending">Pending</option>
                                        <option value="confirmed">Confirmed</option>
                                        <option value="shipped">Shipped</option>
                                        <option value="delivered">Delivered</option>
                                        <option value="cancelled">Cancelled</option>
                                    </select>
                                </div>
                                <div>{{ formatDate(order.orderDate) }}</div>
                            </div>
                        </div>
                    </div>

                    <!-- Users Tab -->
                    <div v-if="adminActiveTab === 'users'">
                        <h3 style="margin-bottom: 2rem;">User Management</h3>
                        
                        <div v-if="loadingUsers" class="loading">
                            <div class="spinner"></div>
                            <p>Loading users...</p>
                        </div>
                        
                        <div v-else class="data-table">
                            <div class="table-header">All Users</div>
                            <div v-for="user in adminUsers" :key="user._id" class="table-row">
                                <div>
                                    <strong>{{ user.name }}</strong>
                                    <div style="font-size: 0.8rem; color: #666;">{{ user.email }}</div>
                                </div>
                                <div>{{ user.role }}</div>
                                <div>{{ formatDate(user.createdAt) }}</div>
                                <div class="table-actions">
                                    <button class="btn btn-small btn-outline">
                                        <i class="fas fa-eye"></i>
                                        View
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Chatbot Tab -->
                    <div v-if="adminActiveTab === 'chatbot'">
                        <h3 style="margin-bottom: 2rem;">Chatbot Analytics</h3>
                        
                        <div v-if="loadingChatbotAnalytics" class="loading">
                            <div class="spinner"></div>
                            <p>Loading chatbot data...</p>
                        </div>
                        
                        <div v-else>
                            <div class="admin-dashboard" style="margin-bottom: 2rem;">
                                <div class="stat-card">
                                    <span class="stat-number">{{ chatbotAnalytics.totalInteractions || 0 }}</span>
                                    <span class="stat-label">Total Interactions</span>
                                </div>
                                <div class="stat-card">
                                    <span class="stat-number">{{ chatbotAnalytics.geminiStatus?.available ? 'Active' : 'Offline' }}</span>
                                    <span class="stat-label">AI Status</span>
                                </div>
                            </div>
                            
                            <!-- Intent Distribution -->
                            <div class="data-table" style="margin-bottom: 2rem;">
                                <div class="table-header">Popular Intents</div>
                                <div v-for="intent in chatbotAnalytics.intentCounts" :key="intent._id" class="table-row">
                                    <div>{{ intent._id || 'Unknown' }}</div>
                                    <div>{{ intent.count }} queries</div>
                                    <div></div>
                                    <div></div>
                                </div>
                            </div>
                            
                            <!-- Recent Interactions -->
                            <div class="data-table">
                                <div class="table-header">Recent Interactions</div>
                                <div v-for="interaction in chatbotAnalytics.recentInteractions" :key="interaction._id" class="table-row">
                                    <div>
                                        <strong>{{ interaction.query }}</strong>
                                        <div style="font-size: 0.8rem; color: #666;">{{ interaction.response?.substring(0, 100) }}...</div>
                                    </div>
                                    <div>{{ interaction.intent }}</div>
                                    <div>{{ interaction.user?.name || 'Anonymous' }}</div>
                                    <div>{{ formatDate(interaction.timestamp) }}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Product Details Modal -->
        <transition name="fade">
            <div v-if="showProductDetails" class="modal-overlay" @click="showProductDetails = false">
                <div class="product-modal" @click.stop>
                    <button @click="showProductDetails = false" class="modal-close">
                        <i class="fas fa-times"></i>
                    </button>
                    
                    <div class="modal-content">
                        <!-- Product Image -->
                        <div class="product-image-section">
                            <div class="product-main-image">
                                <img :src="selectedProduct.image" :alt="selectedProduct.name" />
                                <div v-if="selectedProduct.featured" class="featured-badge">Featured</div>
                            </div>
                        </div>
                        
                        <!-- Product Info -->
                        <div class="product-info">
                            <div class="product-header">
                                <span class="product-brand">{{ selectedProduct.brand }}</span>
                                <h2 class="product-title">{{ selectedProduct.name }}</h2>
                                <div class="product-rating">
                                    <div class="stars">
                                        <i v-for="i in 5" :key="i" :class="['fas', i <= selectedProduct.rating ? 'fa-star' : 'fa-star-o']"></i>
                                    </div>
                                    <span class="rating-text">{{ selectedProduct.rating }} ({{ selectedProduct.reviews?.length || Math.floor(Math.random() * 50) + 10 }} reviews)</span>
                                </div>
                                <div class="product-price">AED {{ selectedProduct.price }}</div>
                            </div>
                            
                            <div class="product-description">
                                <p>{{ selectedProduct.description }}</p>
                            </div>
                            
                            <!-- Options -->
                            <div class="product-options">
                                <!-- Size Selection -->
                                <div v-if="selectedProduct.sizes && selectedProduct.sizes.length > 0" class="option-group">
                                    <label>Size</label>
                                    <div class="option-buttons">
                                        <button 
                                            v-for="size in selectedProduct.sizes" 
                                            :key="size"
                                            @click="selectedSize = size"
                                            :class="['option-btn', { active: selectedSize === size }]"
                                        >
                                            {{ size }}
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Color Selection -->
                                <div v-if="selectedProduct.colors && selectedProduct.colors.length > 0" class="option-group">
                                    <label>Color</label>
                                    <div class="option-buttons">
                                        <button 
                                            v-for="color in selectedProduct.colors" 
                                            :key="color"
                                            @click="selectedColor = color"
                                            :class="['option-btn', { active: selectedColor === color }]"
                                        >
                                            {{ color }}
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Quantity -->
                                <div class="option-group">
                                    <label>Quantity</label>
                                    <div class="quantity-selector">
                                        <button @click="selectedQuantity = Math.max(1, selectedQuantity - 1)" class="qty-btn">-</button>
                                        <span class="qty-display">{{ selectedQuantity }}</span>
                                        <button @click="selectedQuantity = Math.min(10, selectedQuantity + 1)" class="qty-btn">+</button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Action Button -->
                            <button @click="addToCartFromDetails" class="add-to-cart-btn">
                                Add to Cart - AED {{ selectedProduct.price * selectedQuantity }}
                            </button>
                            
                            <!-- Product Details -->
                            <div class="product-details">
                                <div class="detail-item">
                                    <strong>Category:</strong> {{ selectedProduct.category }}
                                </div>
                                <div v-if="selectedProduct.subcategory" class="detail-item">
                                    <strong>Type:</strong> {{ selectedProduct.subcategory }}
                                </div>
                                <div class="detail-item">
                                    <strong>Stock:</strong> {{ selectedProduct.stock }} items available
                                </div>
                            </div>

                            <!-- Reviews Section -->
                            <div v-if="selectedProduct.reviews && selectedProduct.reviews.length > 0" class="reviews-section">
                                <h3>Customer Reviews</h3>
                                <div v-for="review in selectedProduct.reviews" :key="review._id" class="review-item">
                                    <div class="review-header">
                                        <span class="review-author">{{ review.user?.name || 'Anonymous' }}</span>
                                        <span class="review-date">{{ formatDate(review.date) }}</span>
                                    </div>
                                    <div class="review-rating">
                                        <i v-for="i in 5" :key="i" :class="['fas', i <= review.rating ? 'fa-star' : 'fa-star-o']"></i>
                                    </div>
                                    <div class="review-comment">{{ review.comment }}</div>
                                </div>
                                
                                <!-- Add Review Form (if user is logged in) -->
                                <div v-if="user && !hasUserReviewed" class="add-review">
                                    <h4>Add Your Review</h4>
                                    <form @submit.prevent="submitReview">
                                        <div class="form-group">
                                            <label>Rating</label>
                                            <select v-model="newReview.rating" required class="filter-input">
                                                <option value="">Select Rating</option>
                                                <option value="1">1 Star</option>
                                                <option value="2">2 Stars</option>
                                                <option value="3">3 Stars</option>
                                                <option value="4">4 Stars</option>
                                                <option value="5">5 Stars</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label>Comment</label>
                                            <textarea v-model="newReview.comment" rows="3" class="filter-input"></textarea>
                                        </div>
                                        <button type="submit" class="btn btn-primary">Submit Review</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </transition>

        <!-- Add/Edit Product Modal -->
        <transition name="fade">
            <div v-if="showAddProduct || editingProduct" class="modal-overlay" @click="closeProductModal">
                <div class="modal" @click.stop style="max-width: 600px;">
                    <div class="modal-header">
                        <h2>{{ editingProduct ? 'Edit Product' : 'Add New Product' }}</h2>
                        <button @click="closeProductModal" class="modal-close">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <form @submit.prevent="saveProduct">
                        <div class="form-group">
                            <label>Product Name</label>
                            <input v-model="productForm.name" type="text" required />
                        </div>
                        
                        <div class="form-group">
                            <label>Description</label>
                            <textarea v-model="productForm.description" rows="3" required></textarea>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div class="form-group">
                                <label>Price (AED)</label>
                                <input v-model="productForm.price" type="number" min="0" step="0.01" required />
                            </div>
                            
                            <div class="form-group">
                                <label>Stock</label>
                                <input v-model="productForm.stock" type="number" min="0" required />
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;">
                            <div class="form-group">
                                <label>Category</label>
                                <select v-model="productForm.category" required>
                                    <option value="">Select Category</option>
                                    <option value="men">Men</option>
                                    <option value="women">Women</option>
                                    <option value="kids">Kids</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label>Subcategory</label>
                                <input v-model="productForm.subcategory" type="text" required />
                            </div>
                            
                            <div class="form-group">
                                <label>Brand</label>
                                <input v-model="productForm.brand" type="text" required />
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Sizes (comma separated)</label>
                            <input v-model="productForm.sizesString" type="text" placeholder="S, M, L, XL" />
                        </div>
                        
                        <div class="form-group">
                            <label>Colors (comma separated)</label>
                            <input v-model="productForm.colorsString" type="text" placeholder="Red, Blue, Green" />
                        </div>
                        
                        <div class="form-group">
                            <label>
                                <input v-model="productForm.featured" type="checkbox" />
                                Featured Product
                            </label>
                        </div>
                        
                        <div v-if="productError" class="alert alert-error">
                            {{ productError }}
                        </div>
                        
                        <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i>
                                {{ editingProduct ? 'Update' : 'Add' }} Product
                            </button>
                            <button type="button" @click="closeProductModal" class="btn btn-secondary">
                                Cancel
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </transition>

        <!-- Login Modal -->
        <transition name="fade">
            <div v-if="showLogin" class="modal-overlay" @click="showLogin = false">
                <div class="modal" @click.stop>
                    <div class="modal-header">
                        <h2>{{ loginMode === 'login' ? 'Login' : 'Register' }}</h2>
                        <button @click="showLogin = false" class="modal-close">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <form @submit.prevent="handleAuth">
                        <div v-if="loginMode === 'register'" class="form-group">
                            <label>Name</label>
                            <input v-model="authForm.name" type="text" required />
                        </div>
                        
                        <div class="form-group">
                            <label>Email</label>
                            <input v-model="authForm.email" type="email" required />
                        </div>
                        
                        <div class="form-group">
                            <label>Password</label>
                            <input v-model="authForm.password" type="password" required />
                        </div>
                        
                        <div v-if="authError" class="alert alert-error">
                            {{ authError }}
                        </div>
                        
                        <button type="submit" class="btn btn-primary" style="width: 100%; margin-bottom: 1rem;">
                            {{ loginMode === 'login' ? 'Login' : 'Register' }}
                        </button>
                    </form>
                    
                    <p style="text-align: center;">
                        {{ loginMode === 'login' ? "Don't have an account?" : 'Already have an account?' }}
                        <a href="#" @click="toggleLoginMode" style="color: #667eea;">
                            {{ loginMode === 'login' ? 'Register' : 'Login' }}
                        </a>
                    </p>
                </div>
            </div>
        </transition>

        <!-- Cart Modal -->
        <transition name="fade">
            <div v-if="showCart" class="modal-overlay" @click="showCart = false">
                <div class="modal" @click.stop style="max-width: 600px;">
                    <div class="modal-header">
                        <h2>Shopping Cart</h2>
                        <button @click="showCart = false" class="modal-close">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <div v-if="cart.length === 0" style="text-align: center; padding: 2rem;">
                        <i class="fas fa-shopping-cart" style="font-size: 3rem; color: #ddd; margin-bottom: 1rem;"></i>
                        <p>Your cart is empty</p>
                    </div>
                    
                    <div v-else>
                        <div v-for="item in cart" :key="item.id + '_' + item.size + '_' + item.color" class="cart-item">
                            <div class="cart-item-image">
                                <i class="fas fa-tshirt"></i>
                            </div>
                            <div class="cart-item-info">
                                <div class="product-name">{{ item.name }}</div>
                                <div class="product-brand">{{ item.brand }}</div>
                                <div class="product-price">AED {{ item.price }}</div>
                                <div v-if="item.size">Size: {{ item.size }}</div>
                                <div v-if="item.color">Color: {{ item.color }}</div>
                            </div>
                            <div class="cart-item-actions">
                                <button @click="updateQuantity(item, item.quantity - 1)" class="quantity-btn">
                                    <i class="fas fa-minus"></i>
                                </button>
                                <span style="margin: 0 1rem;">{{ item.quantity }}</span>
                                <button @click="updateQuantity(item, item.quantity + 1)" class="quantity-btn">
                                    <i class="fas fa-plus"></i>
                                </button>
                                <button @click="removeFromCart(item)" class="quantity-btn" style="margin-left: 1rem; color: #dc3545;">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="cart-summary">
                            <div style="display: flex; justify-content: space-between; font-size: 1.2rem; font-weight: bold;">
                                <span>Total: AED {{ cartTotal }}</span>
                            </div>
                            <button @click="checkout" class="btn btn-primary" style="width: 100%; margin-top: 1rem;">
                                Proceed to Checkout
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </transition>

        <!-- Chatbot -->
        <div class="chatbot-container">
            <button @click="toggleChatbot" class="chatbot-toggle">
                <i class="fas fa-comments"></i>
            </button>
            
            <transition name="fade">
                <div v-if="showChatbot" class="chatbot-window">
                    <div class="chatbot-header">
                        <div>Silk Touch Assistant</div>
                        <button @click="showChatbot = false" style="background: none; border: none; color: white; font-size: 1.2rem;">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <div class="chatbot-messages" ref="chatMessages">
                        <div v-for="message in chatMessages" :key="message.id" :class="['message', message.type]">
                            {{ message.text }}
                        </div>
                    </div>
                    
                    <div class="chatbot-input">
                        <input 
                            v-model="chatInput" 
                            @keyup.enter="sendMessage"
                            placeholder="Ask me anything..."
                            :disabled="chatLoading"
                        />
                        <button @click="sendMessage" :disabled="chatLoading">
                            <i v-if="chatLoading" class="fas fa-spinner fa-spin"></i>
                            <i v-else class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </transition>
        </div>

        <!-- Success/Error Messages -->
        <transition name="fade">
            <div v-if="message" :class="['alert', message.type === 'success' ? 'alert-success' : 'alert-error']" style="position: fixed; top: 20px; right: 20px; z-index: 3000; max-width: 300px;">
                {{ message.text }}
            </div>
        </transition>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    // API Configuration
                    baseURL: 'https://cst3990-backend-8f55.onrender.com/api',
                    apiConnected: false,
                    
                    // Navigation
                    activeView: 'home',
                    currentCategory: '',
                    
                    // User & Auth
                    user: null,
                    token: localStorage.getItem('token'),
                    showLogin: false,
                    loginMode: 'login',
                    authForm: { name: '', email: '', password: '' },
                    authError: '',
                    
                    // Profile
                    profileForm: {
                        name: '',
                        email: '',
                        phone: '',
                        address: {
                            street: '',
                            city: '',
                            postalCode: '',
                            country: ''
                        }
                    },
                    profileError: '',
                    
                    // Search
                    searchQuery: '',
                    suggestions: [],
                    
                    // Products
                    products: [],
                    featuredProducts: [],
                    loading: false,
                    currentPage: 1,
                    totalPages: 1,
                    totalProducts: 0,
                    
                    // Filters
                    filters: {
                        sort: '',
                        minPrice: '',
                        maxPrice: '',
                        size: '',
                        brand: ''
                    },
                    availableSizes: ['XS', 'S', 'M', 'L', 'XL', 'XXL', 'One Size'],
                    availableBrands: [],
                    
                    // Product Details
                    showProductDetails: false,
                    selectedProduct: {},
                    selectedSize: '',
                    selectedColor: '',
                    selectedQuantity: 1,
                    
                    // Reviews
                    newReview: { rating: '', comment: '' },
                    
                    // Cart
                    cart: JSON.parse(localStorage.getItem('cart') || '[]'),
                    showCart: false,
                    
                    // Orders
                    orders: [],
                    loadingOrders: false,
                    
                    // Admin
                    adminActiveTab: 'overview',
                    analytics: {},
                    loadingAnalytics: false,
                    adminOrders: [],
                    loadingAdminOrders: false,
                    adminUsers: [],
                    loadingUsers: false,
                    chatbotAnalytics: {},
                    loadingChatbotAnalytics: false,
                    
                    // Product Management
                    showAddProduct: false,
                    editingProduct: null,
                    productForm: {
                        name: '',
                        description: '',
                        price: '',
                        category: '',
                        subcategory: '',
                        brand: '',
                        stock: '',
                        sizesString: '',
                        colorsString: '',
                        featured: false
                    },
                    productError: '',
                    
                    // Chatbot
                    showChatbot: false,
                    chatInput: '',
                    chatMessages: [
                        { id: 1, type: 'bot', text: 'Hello! Welcome to Silk Touch. How can I help you today?' }
                    ],
                    chatLoading: false,
                    chatSessionId: 'session_' + Date.now(),
                    
                    // UI
                    message: null,
                    
                    // Debounce timer
                    debounceTimer: null,
                    
                    // Enhanced fallback data (same as before but organized)
                    fallbackProducts: [
                        // Men's Products
                        {
                            _id: '1', name: 'Classic White Shirt', description: 'Premium cotton dress shirt perfect for office or formal occasions.',
                            brand: 'Silk Touch Premium', price: 129, category: 'men', subcategory: 'shirts', rating: 4.5,
                            sizes: ['S', 'M', 'L', 'XL'], colors: ['White', 'Light Blue'], featured: true, stock: 50,
                            image: 'https://images.unsplash.com/photo-1596755094514-f87e34085b2c?w=400&h=600&fit=crop&crop=center'
                        },
                        {
                            _id: '2', name: 'Casual Denim Jeans', description: 'Comfortable straight-fit jeans made from high-quality denim.',
                            brand: 'Urban Style', price: 199, category: 'men', subcategory: 'jeans', rating: 4.3,
                            sizes: ['S', 'M', 'L', 'XL'], colors: ['Dark Blue', 'Light Blue', 'Black'], featured: true, stock: 75,
                            image: 'https://images.unsplash.com/photo-1542272604-787c3835535d?w=400&h=600&fit=crop&crop=center'
                        },
                        {
                            _id: '3', name: 'Business Blazer', description: 'Elegant blazer for professional settings.',
                            brand: 'Executive', price: 399, category: 'men', subcategory: 'blazers', rating: 4.7,
                            sizes: ['S', 'M', 'L', 'XL'], colors: ['Navy', 'Charcoal', 'Black'], featured: false, stock: 30,
                            image: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=400&h=600&fit=crop&crop=center'
                        },
                        // Women's Products
                        {
                            _id: '7', name: 'Elegant Evening Dress', description: 'Stunning evening dress perfect for special occasions.',
                            brand: 'Glamour', price: 299, category: 'women', subcategory: 'dresses', rating: 4.8,
                            sizes: ['XS', 'S', 'M', 'L'], colors: ['Black', 'Navy', 'Burgundy'], featured: true, stock: 25,
                            image: 'https://images.unsplash.com/photo-1566479179817-fb77d2a4b8c9?w=400&h=600&fit=crop&crop=center'
                        },
                        {
                            _id: '8', name: 'Casual Summer Blouse', description: 'Light and airy blouse perfect for summer days.',
                            brand: 'Summer Breeze', price: 89, category: 'women', subcategory: 'blouses', rating: 4.4,
                            sizes: ['XS', 'S', 'M', 'L', 'XL'], colors: ['White', 'Pink', 'Yellow', 'Light Blue'], featured: true, stock: 60,
                            image: 'https://images.unsplash.com/photo-1485462537415-ac24221ce21d?w=400&h=600&fit=crop&crop=center'
                        },
                        // Kids Products
                        {
                            _id: '14', name: 'Kids Colorful T-Shirt', description: 'Fun and colorful t-shirt for active kids.',
                            brand: 'Little Ones', price: 39, category: 'kids', subcategory: 'tshirts', rating: 4.5,
                            sizes: ['S', 'M', 'L'], colors: ['Rainbow', 'Blue', 'Pink', 'Green'], featured: true, stock: 90,
                            image: 'https://images.unsplash.com/photo-1519578922761-228e1b73de71?w=400&h=600&fit=crop&crop=center'
                        }
                    ]
                }
            },
            
            computed: {
                cartItemsCount() {
                    return this.cart.reduce((total, item) => total + item.quantity, 0);
                },
                
                cartTotal() {
                    return this.cart.reduce((total, item) => total + (item.price * item.quantity), 0);
                },
                
                visiblePages() {
                    const pages = [];
                    const start = Math.max(1, this.currentPage - 2);
                    const end = Math.min(this.totalPages, this.currentPage + 2);
                    
                    for (let i = start; i <= end; i++) {
                        pages.push(i);
                    }
                    return pages;
                },
                
                hasUserReviewed() {
                    if (!this.user || !this.selectedProduct.reviews) return false;
                    return this.selectedProduct.reviews.some(review => review.user?._id === this.user.id);
                }
            },
            
            async mounted() {
                await this.checkApiConnection();
                
                if (this.apiConnected) {
                    axios.defaults.baseURL = this.baseURL;
                    if (this.token) {
                        axios.defaults.headers.common['Authorization'] = `Bearer ${this.token}`;
                        await this.loadUserProfile();
                    }
                    await this.loadFilterOptions();
                }
                
                await this.loadProducts();
                await this.loadFeaturedProducts();
            },
            
            methods: {
                // Navigation
                setActiveView(view) {
                    this.activeView = view;
                    
                    // Load data based on view
                    if (view === 'orders' && this.user && this.apiConnected) {
                        this.loadOrders();
                    } else if (view === 'admin' && this.user?.role === 'admin' && this.apiConnected) {
                        this.loadAdminData();
                    } else if (view === 'profile' && this.user) {
                        this.loadProfileData();
                    }
                },
                
                // API Connection
                async checkApiConnection() {
                    const testUrls = [
                        'http://localhost:5000/api',
                        'http://127.0.0.1:5000/api',
                        'https://cst3990-backend-8f55.onrender.com/api'
                    ];

                    for (const url of testUrls) {
                        try {
                            await axios.get(`${url}/products?limit=1`, { timeout: 3000, baseURL: undefined });
                            this.baseURL = url;
                            this.apiConnected = true;
                            axios.defaults.baseURL = url;
                            console.log(`âœ… Connected to API: ${url}`);
                            return;
                        } catch (error) {
                            console.log(`âŒ Failed: ${url}`);
                        }
                    }
                    
                    this.apiConnected = false;
                    console.warn('âš ï¸ API not available, using demo mode');
                },

                async retryConnection() {
                    this.loading = true;
                    this.apiConnected = false;
                    axios.defaults.baseURL = '';
                    
                    await this.checkApiConnection();
                    
                    if (this.apiConnected && this.token) {
                        axios.defaults.headers.common['Authorization'] = `Bearer ${this.token}`;
                        await this.loadUserProfile();
                    }
                    
                    await this.loadProducts();
                    await this.loadFilterOptions();
                    this.showMessage(this.apiConnected ? 'âœ… Connected successfully!' : 'âŒ Still unable to connect', 
                                   this.apiConnected ? 'success' : 'error');
                    this.loading = false;
                },
                
                // Authentication
                async handleAuth() {
                    if (!this.apiConnected) {
                        this.authError = 'Authentication requires backend connection.';
                        return;
                    }
                    
                    try {
                        this.authError = '';
                        const endpoint = this.loginMode === 'login' ? '/auth/login' : '/auth/register';
                        const data = this.loginMode === 'login' 
                            ? { email: this.authForm.email, password: this.authForm.password }
                            : this.authForm;
                        
                        const response = await axios.post(endpoint, data);
                        
                        this.token = response.data.token;
                        this.user = response.data.user;
                        
                        localStorage.setItem('token', this.token);
                        axios.defaults.headers.common['Authorization'] = `Bearer ${this.token}`;
                        
                        this.showLogin = false;
                        this.authForm = { name: '', email: '', password: '' };
                        this.showMessage('Welcome to Silk Touch!', 'success');
                        
                        // Load user cart from server
                        if (this.apiConnected) {
                            await this.syncCart();
                        }
                        
                    } catch (error) {
                        this.authError = error.response?.data?.message || 'Authentication failed';
                    }
                },
                
                async loadUserProfile() {
                    try {
                        const response = await axios.get('/profile');
                        this.user = response.data;
                        this.loadProfileData();
                    } catch (error) {
                        this.logout();
                    }
                },
                
                loadProfileData() {
                    if (this.user) {
                        this.profileForm = {
                            name: this.user.name || '',
                            email: this.user.email || '',
                            phone: this.user.phone || '',
                            address: {
                                street: this.user.address?.street || '',
                                city: this.user.address?.city || '',
                                postalCode: this.user.address?.postalCode || '',
                                country: this.user.address?.country || ''
                            }
                        };
                    }
                },
                
                async updateProfile() {
                    if (!this.apiConnected) {
                        this.profileError = 'Profile update requires backend connection.';
                        return;
                    }
                    
                    try {
                        this.profileError = '';
                        
                        const response = await axios.put('/profile', this.profileForm);
                        this.user = response.data;
                        this.showMessage('Profile updated successfully!', 'success');
                        
                    } catch (error) {
                        this.profileError = error.response?.data?.message || 'Failed to update profile';
                    }
                },
                
                logout() {
                    this.user = null;
                    this.token = null;
                    localStorage.removeItem('token');
                    delete axios.defaults.headers.common['Authorization'];
                    this.activeView = 'home';
                    this.showMessage('Logged out successfully', 'success');
                },
                
                toggleLoginMode() {
                    this.loginMode = this.loginMode === 'login' ? 'register' : 'login';
                    this.authError = '';
                },
                
                // Products
                async loadProducts() {
                    this.loading = true;
                    
                    if (!this.apiConnected) {
                        await this.loadFallbackProducts();
                        return;
                    }
                    
                    try {
                        const params = {
                            page: this.currentPage,
                            limit: 12,
                            ...this.filters
                        };
                        
                        if (this.currentCategory) params.category = this.currentCategory;
                        if (this.searchQuery) params.search = this.searchQuery;
                        
                        const response = await axios.get('/products', { params });
                        
                        this.products = response.data.products || [];
                        this.totalPages = response.data.totalPages || 1;
                        this.totalProducts = response.data.total || 0;
                        
                    } catch (error) {
                        console.error('Failed to load products:', error);
                        await this.loadFallbackProducts();
                    } finally {
                        this.loading = false;
                    }
                },
                
                async loadFallbackProducts() {
                    await new Promise(resolve => setTimeout(resolve, 500));
                    
                    let filteredProducts = [...this.fallbackProducts];
                    
                    if (this.currentCategory) {
                        filteredProducts = filteredProducts.filter(p => p.category === this.currentCategory);
                    }
                    
                    if (this.searchQuery) {
                        const query = this.searchQuery.toLowerCase();
                        filteredProducts = filteredProducts.filter(p => 
                            p.name.toLowerCase().includes(query) || 
                            p.brand.toLowerCase().includes(query)
                        );
                    }
                    
                    if (this.filters.minPrice) {
                        filteredProducts = filteredProducts.filter(p => p.price >= parseInt(this.filters.minPrice));
                    }
                    if (this.filters.maxPrice) {
                        filteredProducts = filteredProducts.filter(p => p.price <= parseInt(this.filters.maxPrice));
                    }
                    
                    if (this.filters.sort) {
                        switch (this.filters.sort) {
                            case 'price_low': filteredProducts.sort((a, b) => a.price - b.price); break;
                            case 'price_high': filteredProducts.sort((a, b) => b.price - a.price); break;
                            case 'rating': filteredProducts.sort((a, b) => b.rating - a.rating); break;
                        }
                    }
                    
                    this.products = filteredProducts;
                    this.totalProducts = filteredProducts.length;
                    this.totalPages = Math.ceil(filteredProducts.length / 12);
                    this.loading = false;
                },
                
                async loadFeaturedProducts() {
                    if (!this.apiConnected) {
                        this.featuredProducts = this.fallbackProducts.filter(p => p.featured).slice(0, 4);
                        return;
                    }
                    
                    try {
                        const response = await axios.get('/products/featured/list');
                        this.featuredProducts = response.data || [];
                    } catch (error) {
                        this.featuredProducts = this.fallbackProducts.filter(p => p.featured).slice(0, 4);
                    }
                },
                
                async loadFilterOptions() {
                    if (!this.apiConnected) return;
                    
                    try {
                        const response = await axios.get('/filters');
                        this.availableBrands = response.data.brands || [];
                        this.availableSizes = response.data.sizes || this.availableSizes;
                    } catch (error) {
                        console.log('Failed to load filter options');
                    }
                },
                
                debounceLoadProducts() {
                    clearTimeout(this.debounceTimer);
                    this.debounceTimer = setTimeout(() => {
                        this.currentPage = 1;
                        this.loadProducts();
                    }, 500);
                },
                
                setCategory(category) {
                    this.currentCategory = category;
                    this.currentPage = 1;
                    this.activeView = 'home';
                    this.loadProducts();
                },
                
                changePage(page) {
                    if (page >= 1 && page <= this.totalPages) {
                        this.currentPage = page;
                        this.loadProducts();
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    }
                },
                
                async viewProduct(product) {
                    // Load full product details if API is connected
                    if (this.apiConnected) {
                        try {
                            const response = await axios.get(`/products/${product._id}`);
                            this.selectedProduct = response.data;
                        } catch (error) {
                            this.selectedProduct = { ...product };
                        }
                    } else {
                        this.selectedProduct = { ...product };
                    }
                    
                    this.selectedSize = this.selectedProduct.sizes ? this.selectedProduct.sizes[0] : '';
                    this.selectedColor = this.selectedProduct.colors ? this.selectedProduct.colors[0] : '';
                    this.selectedQuantity = 1;
                    this.newReview = { rating: '', comment: '' };
                    this.showProductDetails = true;
                },
                
                // Search
                async handleSearch() {
                    if (!this.apiConnected) {
                        if (this.searchQuery.length > 2) {
                            const query = this.searchQuery.toLowerCase();
                            this.suggestions = this.fallbackProducts
                                .filter(p => p.name.toLowerCase().includes(query))
                                .map(p => p.name)
                                .slice(0, 5);
                        } else {
                            this.suggestions = [];
                        }
                        return;
                    }
                    
                    if (this.searchQuery.length > 2) {
                        try {
                            const response = await axios.get('/search/suggestions', {
                                params: { q: this.searchQuery }
                            });
                            this.suggestions = response.data;
                        } catch (error) {
                            this.suggestions = [];
                        }
                    } else {
                        this.suggestions = [];
                    }
                },
                
                selectSuggestion(suggestion) {
                    this.searchQuery = suggestion;
                    this.suggestions = [];
                    this.performSearch();
                },
                
                performSearch() {
                    this.suggestions = [];
                    this.currentPage = 1;
                    this.activeView = 'home';
                    this.loadProducts();
                },
                
                // Cart Management
                async syncCart() {
                    if (!this.apiConnected || !this.user) return;
                    
                    try {
                        // Get server cart
                        const response = await axios.get('/cart');
                        const serverCart = response.data.items || [];
                        
                        // Merge local cart with server cart
                        for (const localItem of this.cart) {
                            await axios.post('/cart/add', {
                                productId: localItem.id,
                                quantity: localItem.quantity,
                                size: localItem.size,
                                color: localItem.color
                            });
                        }
                        
                        // Update local cart with server data
                        const updatedResponse = await axios.get('/cart');
                        this.updateLocalCartFromServer(updatedResponse.data);
                        
                    } catch (error) {
                        console.log('Cart sync failed:', error);
                    }
                },
                
                updateLocalCartFromServer(serverCart) {
                    this.cart = (serverCart.items || []).map(item => ({
                        id: item.product._id,
                        name: item.product.name,
                        brand: item.product.brand,
                        price: item.product.price,
                        quantity: item.quantity,
                        size: item.size,
                        color: item.color
                    }));
                    localStorage.setItem('cart', JSON.stringify(this.cart));
                },
                
                async addToCart(product, quantity = 1) {
                    const size = product.selectedSize || product.sizes?.[0] || null;
                    const color = product.selectedColor || product.colors?.[0] || null;
                    
                    // Update local cart immediately
                    const cartItemKey = `${product._id}_${size}_${color}`;
                    const existingItem = this.cart.find(item => 
                        item.id === product._id && item.size === size && item.color === color
                    );
                    
                    if (existingItem) {
                        existingItem.quantity += quantity;
                    } else {
                        this.cart.push({
                            id: product._id,
                            name: product.name,
                            brand: product.brand,
                            price: product.price,
                            quantity: quantity,
                            size: size,
                            color: color
                        });
                    }
                    
                    localStorage.setItem('cart', JSON.stringify(this.cart));
                    this.showMessage(`${product.name} added to cart!`, 'success');
                    
                    // Sync with server if connected and user logged in
                    if (this.apiConnected && this.user) {
                        try {
                            await axios.post('/cart/add', {
                                productId: product._id,
                                quantity: quantity,
                                size: size,
                                color: color
                            });
                        } catch (error) {
                            console.log('Server cart sync failed:', error);
                        }
                    }
                },
                
                addToCartFromDetails() {
                    this.addToCart({
                        ...this.selectedProduct,
                        selectedSize: this.selectedSize,
                        selectedColor: this.selectedColor
                    }, this.selectedQuantity);
                    this.showProductDetails = false;
                },
                
                async updateQuantity(item, newQuantity) {
                    if (newQuantity <= 0) {
                        this.removeFromCart(item);
                        return;
                    }
                    
                    item.quantity = newQuantity;
                    localStorage.setItem('cart', JSON.stringify(this.cart));
                    
                    if (this.apiConnected && this.user) {
                        try {
                            await axios.put('/cart/update', {
                                productId: item.id,
                                quantity: newQuantity,
                                size: item.size,
                                color: item.color
                            });
                        } catch (error) {
                            console.log('Server cart update failed:', error);
                        }
                    }
                },
                
                async removeFromCart(item) {
                    const index = this.cart.findIndex(cartItem => 
                        cartItem.id === item.id && 
                        cartItem.size === item.size && 
                        cartItem.color === item.color
                    );
                    
                    if (index > -1) {
                        this.cart.splice(index, 1);
                        localStorage.setItem('cart', JSON.stringify(this.cart));
                        this.showMessage('Item removed from cart', 'success');
                        
                        if (this.apiConnected && this.user) {
                            try {
                                await axios.delete(`/cart/remove/${item.id}`, {
                                    params: { size: item.size, color: item.color }
                                });
                            } catch (error) {
                                console.log('Server cart removal failed:', error);
                            }
                        }
                    }
                },
                
                async checkout() {
                    if (!this.user) {
                        this.showCart = false;
                        this.showLogin = true;
                        this.showMessage('Please login to checkout', 'error');
                        return;
                    }
                    
                    if (!this.apiConnected) {
                        this.showMessage('Checkout requires backend connection', 'error');
                        return;
                    }
                    
                    try {
                        const orderData = {
                            items: this.cart.map(item => ({
                                product: item.id,
                                quantity: item.quantity,
                                size: item.size,
                                color: item.color
                            })),
                            shippingAddress: {
                                name: this.user.name,
                                street: this.user.address?.street || '',
                                city: this.user.address?.city || '',
                                postalCode: this.user.address?.postalCode || '',
                                country: this.user.address?.country || 'UAE',
                                phone: this.user.phone || ''
                            },
                            paymentMethod: 'card'
                        };
                        
                        const response = await axios.post('/orders', orderData);
                        
                        this.cart = [];
                        localStorage.removeItem('cart');
                        this.showCart = false;
                        
                        this.showMessage('Order placed successfully!', 'success');
                        this.setActiveView('orders');
                        
                    } catch (error) {
                        console.error('Checkout failed:', error);
                        this.showMessage('Checkout failed. Please try again.', 'error');
                    }
                },
                
                // Orders
                async loadOrders() {
                    if (!this.apiConnected || !this.user) return;
                    
                    this.loadingOrders = true;
                    try {
                        const response = await axios.get('/orders');
                        this.orders = response.data;
                    } catch (error) {
                        console.error('Failed to load orders:', error);
                        this.showMessage('Failed to load orders', 'error');
                    } finally {
                        this.loadingOrders = false;
                    }
                },
                
                // Reviews
                async submitReview() {
                    if (!this.apiConnected || !this.user) {
                        this.showMessage('Please login to submit review', 'error');
                        return;
                    }
                    
                    try {
                        // This would be implemented if you add review endpoints to your backend
                        const reviewData = {
                            rating: parseInt(this.newReview.rating),
                            comment: this.newReview.comment
                        };
                        
                        // For now, just show success message
                        this.showMessage('Review submitted successfully!', 'success');
                        this.newReview = { rating: '', comment: '' };
                        
                        // In a real implementation, you'd refresh the product data
                        
                    } catch (error) {
                        this.showMessage('Failed to submit review', 'error');
                    }
                },
                
                // Admin Functions
                async loadAdminData() {
                    if (!this.apiConnected || this.user?.role !== 'admin') return;
                    
                    this.loadAnalytics();
                    this.loadAdminOrders();
                    this.loadAdminUsers();
                    this.loadChatbotAnalytics();
                },
                
                async loadAnalytics() {
                    this.loadingAnalytics = true;
                    try {
                        const response = await axios.get('/admin/analytics');
                        this.analytics = response.data;
                    } catch (error) {
                        console.error('Failed to load analytics:', error);
                    } finally {
                        this.loadingAnalytics = false;
                    }
                },
                
                async loadAdminOrders() {
                    this.loadingAdminOrders = true;
                    try {
                        const response = await axios.get('/admin/orders');
                        this.adminOrders = response.data;
                    } catch (error) {
                        console.error('Failed to load admin orders:', error);
                    } finally {
                        this.loadingAdminOrders = false;
                    }
                },
                
                async loadAdminUsers() {
                    this.loadingUsers = true;
                    try {
                        const response = await axios.get('/admin/users');
                        this.adminUsers = response.data;
                    } catch (error) {
                        console.error('Failed to load users:', error);
                    } finally {
                        this.loadingUsers = false;
                    }
                },
                
                async loadChatbotAnalytics() {
                    this.loadingChatbotAnalytics = true;
                    try {
                        const response = await axios.get('/chatbot/analytics');
                        this.chatbotAnalytics = response.data;
                    } catch (error) {
                        console.error('Failed to load chatbot analytics:', error);
                    } finally {
                        this.loadingChatbotAnalytics = false;
                    }
                },
                
                async updateOrderStatus(orderId, status) {
                    try {
                        await axios.put(`/admin/orders/${orderId}/status`, { status });
                        this.showMessage('Order status updated', 'success');
                    } catch (error) {
                        this.showMessage('Failed to update order status', 'error');
                    }
                },
                
                // Product Management
                editProduct(product) {
                    this.editingProduct = product;
                    this.productForm = {
                        name: product.name,
                        description: product.description,
                        price: product.price,
                        category: product.category,
                        subcategory: product.subcategory,
                        brand: product.brand,
                        stock: product.stock,
                        sizesString: product.sizes ? product.sizes.join(', ') : '',
                        colorsString: product.colors ? product.colors.join(', ') : '',
                        featured: product.featured
                    };
                },
                
                async saveProduct() {
                    if (!this.apiConnected) {
                        this.productError = 'Product management requires backend connection';
                        return;
                    }
                    
                    try {
                        this.productError = '';
                        
                        const productData = {
                            ...this.productForm,
                            price: parseFloat(this.productForm.price),
                            stock: parseInt(this.productForm.stock),
                            sizes: this.productForm.sizesString.split(',').map(s => s.trim()).filter(Boolean),
                            colors: this.productForm.colorsString.split(',').map(s => s.trim()).filter(Boolean)
                        };
                        
                        delete productData.sizesString;
                        delete productData.colorsString;
                        
                        if (this.editingProduct) {
                            await axios.put(`/products/${this.editingProduct._id}`, productData);
                            this.showMessage('Product updated successfully!', 'success');
                        } else {
                            await axios.post('/products', productData);
                            this.showMessage('Product added successfully!', 'success');
                        }
                        
                        this.closeProductModal();
                        this.loadProducts();
                        
                    } catch (error) {
                        this.productError = error.response?.data?.message || 'Failed to save product';
                    }
                },
                
                async deleteProduct(productId) {
                    if (!confirm('Are you sure you want to delete this product?')) return;
                    
                    try {
                        await axios.delete(`/products/${productId}`);
                        this.showMessage('Product deleted successfully!', 'success');
                        this.loadProducts();
                    } catch (error) {
                        this.showMessage('Failed to delete product', 'error');
                    }
                },
                
                closeProductModal() {
                    this.showAddProduct = false;
                    this.editingProduct = null;
                    this.productForm = {
                        name: '', description: '', price: '', category: '', subcategory: '',
                        brand: '', stock: '', sizesString: '', colorsString: '', featured: false
                    };
                    this.productError = '';
                },
                
                // Chatbot
                toggleChatbot() {
                    this.showChatbot = !this.showChatbot;
                    if (this.showChatbot) {
                        this.$nextTick(() => {
                            this.scrollChatToBottom();
                        });
                    }
                },
                
                async sendMessage() {
                    if (!this.chatInput.trim()) return;
                    
                    const userMessage = {
                        id: Date.now(),
                        type: 'user',
                        text: this.chatInput
                    };
                    
                    this.chatMessages.push(userMessage);
                    const query = this.chatInput;
                    this.chatInput = '';
                    this.chatLoading = true;
                    
                    this.$nextTick(() => {
                        this.scrollChatToBottom();
                    });
                    
                    if (!this.apiConnected) {
                        await this.handleFallbackChatbot(query);
                        return;
                    }
                    
                    try {
                        const response = await axios.post('/chatbot/query', {
                            query: query,
                            sessionId: this.chatSessionId,
                            context: this.chatMessages.slice(-6).map(msg => ({
                                role: msg.type === 'user' ? 'user' : 'assistant',
                                content: msg.text
                            }))
                        });
                        
                        const botMessage = {
                            id: Date.now() + 1,
                            type: 'bot',
                            text: response.data.response
                        };
                        
                        this.chatMessages.push(botMessage);
                        
                    } catch (error) {
                        console.error('Chatbot API error:', error);
                        const errorMessage = {
                            id: Date.now() + 1,
                            type: 'bot',
                            text: 'Sorry, I\'m having trouble connecting right now. Please try again later or browse our website directly.'
                        };
                        
                        this.chatMessages.push(errorMessage);
                    } finally {
                        this.chatLoading = false;
                        this.$nextTick(() => {
                            this.scrollChatToBottom();
                        });
                    }
                },
                
                async handleFallbackChatbot(query) {
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    let response = "I'm currently in demo mode. ";
                    const queryLower = query.toLowerCase();
                    
                    if (queryLower.includes('price') || queryLower.includes('cost')) {
                        response += "Our products range from AED 39 to AED 399. You can see all prices on the products page!";
                    } else if (queryLower.includes('size') || queryLower.includes('sizing')) {
                        response += "We offer sizes from XS to XXL depending on the product. Check individual product pages for available sizes.";
                    } else if (queryLower.includes('shipping') || queryLower.includes('delivery')) {
                        response += "We offer free shipping on orders over AED 200. Standard delivery takes 3-7 business days across the UAE.";
                    } else if (queryLower.includes('return')) {
                        response += "We have a 30-day return policy for unworn items with tags. Returns are easy and hassle-free!";
                    } else if (queryLower.includes('recommend') || queryLower.includes('suggest')) {
                        response += "Check out our featured products! We have great options in Men's, Women's, and Kids' collections.";
                    } else {
                        response += "I can help you with questions about our products, pricing, sizes, shipping, and returns. What would you like to know?";
                    }
                    
                    const botMessage = {
                        id: Date.now() + 1,
                        type: 'bot',
                        text: response
                    };
                    
                    this.chatMessages.push(botMessage);
                    this.chatLoading = false;
                    this.$nextTick(() => {
                        this.scrollChatToBottom();
                    });
                },
                
                scrollChatToBottom() {
                    const chatMessages = this.$refs.chatMessages;
                    if (chatMessages) {
                        chatMessages.scrollTop = chatMessages.scrollHeight;
                    }
                },
                
                // Utility Methods
                handleImageError(event) {
                    event.target.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjYwMCIgdmlld0JveD0iMCAwIDQwMCA2MDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI0MDAiIGhlaWdodD0iNjAwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik0yMDAgMzAwQzIyNy42MTQgMzAwIDI1MCAyNzcuNjE0IDI1MCAyNTBDMjUwIDIyMi4zODYgMjI3LjYxNCAyMDAgMjAwIDIwMEMxNzIuMzg2IDIwMCAxNTAgMjIyLjM4NiAxNTAgMjUwQzE1MCAyNzcuNjE0IDE3Mi4zODYgMzAwIDIwMCAzMDBaIiBmaWxsPSIjOUNBM0FGIi8+CjxwYXRoIGQ9Ik0yMDAgMzUwQzE2MS4zNCAzNTAgMTMwIDMxOC42NiAxMzAgMjgwQzEzMCAyNDEuMzQgMTYxLjM0IDIxMCAyMDAgMjEwQzIzOC42NiAyMTAgMjcwIDI0MS4zNCAyNzAgMjgwQzI3MCAzMTguNjYgMjM4LjY2IDM1MCAyMDAgMzUwWiIgc3Ryb2tlPSIjOUNBM0FGIiBzdHJva2Utd2lkdGg9IjIiLz4KPC9zdmc+';
                },
                
                formatDate(dateString) {
                    if (!dateString) return '';
                    const date = new Date(dateString);
                    return date.toLocaleDateString('en-US', { 
                        year: 'numeric', 
                        month: 'short', 
                        day: 'numeric' 
                    });
                },
                
                showMessage(text, type = 'success') {
                    this.message = { text, type };
                    setTimeout(() => {
                        this.message = null;
                    }, 5000);
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
